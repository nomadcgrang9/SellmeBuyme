# 2026년 1월 19일 작업 내역

## 개요

이번 작업은 새 랜딩 페이지(`/new-landing`)의 UI/UX 개선에 집중했습니다. 주요 변경사항은 패널 토글 시스템, JobCard 디자인 개선, D-Day 표시 시스템 완성, 그리고 선택 테두리 수정입니다.

---

## 1. 패널 토글 시스템 구현

### 변경 내용
- 네이버 지도 스타일의 좌우 슬라이드 토글 버튼 추가
- 공고 목록 헤더 전체 클릭 시 토글 가능
- 패널과 토글 버튼이 붙어있도록 간격 제거

### 관련 커밋
- `9626f6e` feat(ui): 네이버 지도 스타일 패널 좌우 슬라이드 토글 버튼 추가
- `8111191` fix(ui): 패널과 토글 버튼 간격 제거
- `cca8fb4` fix(ui): 상세 패널 및 토글 버튼 애니메이션 제거

---

## 2. JobCard 컴팩트 디자인

### 변경 내용
- 카드 크기를 더 작고 정보 밀도 높게 개선
- 태그 최대 3개 표시, 나머지는 `+N` 형태로 표시
- 위치와 보수를 한 줄로 압축

### 관련 파일
- `src/pages/new-landing/components/JobCard.tsx`

---

## 3. D-Day 표시 시스템 완성

### 변경 내용

#### 3.1 D-Day 5일 이하로 제한
- 기존: D-day가 모든 공고에 표시됨 (D-15 등)
- 변경: D-5 이하인 공고만 D-day 표시

#### 3.2 색상 시스템 통일
| 조건 | 배경색 | 글자색 |
|------|--------|--------|
| D-Day (마감 당일) | `bg-red-500` | `text-white` |
| D-1 ~ D-3 | `bg-red-100` | `text-red-700` |
| D-4 ~ D-5 | `bg-orange-100` | `text-orange-700` |

#### 3.3 마감 당일(D-Day) 버그 수정 ⭐

**문제**: 마감 당일인 공고에 D-Day가 표시되지 않음

**원인**: `calculateDaysLeft()` 함수에서 `diff === 0`일 때 `undefined` 반환

```typescript
// 수정 전 (버그)
function calculateDaysLeft(deadline: string): number | undefined {
  const today = new Date();
  const deadlineDate = new Date(deadline);
  const diff = Math.ceil((deadlineDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
  return diff > 0 ? diff : undefined;  // 0이면 undefined 반환!
}
```

**해결**: `diff >= 0`으로 수정하여 마감 당일도 표시

```typescript
// 수정 후
function calculateDaysLeft(deadline: string): number | undefined {
  const today = new Date();
  today.setHours(0, 0, 0, 0);  // 시간 제거하여 날짜만 비교
  const deadlineDate = new Date(deadline);
  deadlineDate.setHours(0, 0, 0, 0);
  const diff = Math.ceil((deadlineDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
  return diff >= 0 ? diff : undefined;  // 0 이상이면 반환 (D-Day 포함)
}
```

### 관련 파일
- `src/lib/supabase/queries.ts` - `calculateDaysLeft()` 함수
- `src/pages/new-landing/components/JobCard.tsx`
- `src/pages/new-landing/components/JobDetailPanel.tsx`
- `src/pages/new-landing/components/Hero.tsx`

### 관련 커밋
- `4792084` feat(ui): D-day 색상 시스템 전역 통일
- `65b26f2` feat(ui): D-day 표시를 5일 이하로 제한
- `9d6a8b5` fix: D-Day 마감 당일(daysLeft=0) 표시되도록 수정

---

## 4. 선택된 공고 테두리 수정

### 문제
- 선택된 공고 항목에 파란색 왼쪽 테두리가 표시되어야 함
- 첫 번째 항목만 테두리가 적용되고, 다른 항목은 적용 안 됨

### 원인
CSS 특이성(specificity) 문제로 `border-l-[#5B6EF7]`이 적용되지 않음

### 해결

```tsx
// 수정 전
className={`... border-l-2 ${selectedJob?.id === job.id
  ? 'bg-blue-50 border-l-[#5B6EF7]'
  : 'border-l-transparent hover:bg-gray-50'
}`}

// 수정 후
className={`... border-l-4 border-l-transparent ${selectedJob?.id === job.id
  ? 'bg-blue-50 !border-l-[#5B6EF7]'  // !important 추가
  : 'hover:bg-gray-50'
}`}
```

**변경 포인트**:
1. `border-l-2` → `border-l-4`: 더 두꺼운 테두리로 가시성 향상
2. `border-l-transparent`를 기본값으로 항상 적용
3. `!border-l-[#5B6EF7]`: Tailwind의 `!important` 프리픽스 사용

### 관련 파일
- `src/pages/new-landing/components/Hero.tsx` (1306-1309번째 줄)

### 관련 커밋
- `44d6e82` fix(ui): 선택된 공고 왼쪽 테두리 CSS 우선순위 수정

---

## 5. 기타 개선사항

### EmptyState 및 스켈레톤
- 검색 결과가 없을 때 EmptyState 컴포넌트 표시
- 로딩 중 스켈레톤 UI 표시

### 필터 태그
- 적용된 필터를 태그 형태로 표시
- 태그 클릭 시 해당 필터 제거

---

---

## 6. React Performance 최적화 (Vercel Best Practices)

### 개요
Vercel React Best Practices 가이드라인을 기반으로 코드베이스 감사 및 성능 최적화를 수행했습니다.

### Phase 1: Re-render 최적화

#### 1.1 Zustand Selector 최적화 (`src/App.tsx`)
```typescript
// Before - 9개 속성 동시 구독 (불필요한 리렌더 발생)
const { searchQuery, filters, viewType, ... } = useSearchStore((state) => ({...}));

// After - 개별 selector로 분리
const searchQuery = useSearchStore((s) => s.searchQuery);
const filters = useSearchStore((s) => s.filters);
const viewType = useSearchStore((s) => s.viewType);
// ... 각각 독립적으로 구독
```

#### 1.2 useCallback 적용
19개 핸들러 함수에 useCallback 적용하여 안정적인 참조 유지:
- `handleCardClick`, `handleProfileClose`, `handleProfileComplete`
- `handleOpenProfileView`, `handleChatClick`, `handleBookmarkClick`
- `handleHomeClick`, `handleJobEditClick` 등

#### 1.3 React.memo 적용 (6개 카드 컴포넌트)
- `JobCard.tsx`
- `TalentCard.tsx`
- `ExperienceCard.tsx`
- `CompactJobCard.tsx`
- `CompactTalentCard.tsx`
- `CardGrid.tsx`

### Phase 2: Bundle 최적화

#### 2.1 React.lazy + Suspense (`src/main.tsx`)
```typescript
const App = lazy(() => import('./App'))
const AdminPage = lazy(() => import('./pages/AdminPage'))
const DeveloperPage = lazy(() => import('./pages/DeveloperPage'))
// ... 모든 페이지 컴포넌트 동적 임포트

// 로딩 폴백 컴포넌트
function PageLoading() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="text-center">
        <div className="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3" />
        <p className="text-gray-500 text-sm">로딩 중...</p>
      </div>
    </div>
  )
}
```

#### 2.2 Vite manualChunks 설정 (`vite.config.ts`)
```typescript
manualChunks: {
  'vendor-blocknote': ['@blocknote/core', '@blocknote/mantine', '@blocknote/react'],
  'vendor-recharts': ['recharts'],
  'vendor-icons': ['@tabler/icons-react', 'lucide-react'],
  'vendor-supabase': ['@supabase/supabase-js'],
  'vendor-animation': ['framer-motion'],
  'vendor-react': ['react', 'react-dom'],
}
```

### 성능 측정 결과

| 항목 | 기존 | 최적화 후 | 변화 |
|------|------|---------|------|
| **FCP** | 304ms | 280ms | ✅ **7.9% 개선** |
| **JS 청크 수** | 2개 | 12개 | ✅ 코드 분할 |
| **엔트리 번들** | 단일 | 6.4KB | ✅ 대폭 감소 |

#### 청크 분할 결과
- `vendor-blocknote`: 144.7KB (에디터)
- `vendor-supabase`: 40.9KB (DB 클라이언트)
- `vendor-animation`: 39.3KB (Framer Motion)
- `App.js`: 25.8KB (메인 앱)

### 관련 파일
- `src/App.tsx` - Zustand selector + useCallback
- `src/main.tsx` - React.lazy + Suspense
- `vite.config.ts` - manualChunks 설정
- `src/components/cards/*.tsx` - React.memo 적용

### 관련 커밋
- `10a5e82` perf: React 성능 최적화 (Vercel Best Practices 적용)

### 테스트 결과
- 기존 사이트: https://3bc84b72.sellmebuyme.pages.dev/
- 업데이트 사이트: https://961697c2.sellmebuyme.pages.dev/
- 상세 분석: `test0109.md`

---

## PR 정보

- **PR 번호**: #19
- **PR URL**: https://github.com/nomadcgrang9/SellmeBuyme/pull/19
- **브랜치**: `kimwoody` → `main`
- **주요 변경**: UI/UX 개선 + React 성능 최적화

---

## 배운 점

1. **Tailwind CSS 특이성**: 조건부 클래스에서 색상이 적용되지 않으면 `!` 프리픽스로 우선순위 높이기
2. **날짜 계산 시 주의점**: `> 0` vs `>= 0`의 차이가 D-Day 표시 여부를 결정
3. **Cloudflare Pages 배포**: 서브 브랜치 푸시 시에도 새 배포가 생성됨
4. **Zustand 최적화**: 객체 destructuring 대신 개별 selector 사용으로 불필요한 리렌더 방지
5. **코드 분할**: React.lazy + Suspense와 Vite manualChunks 조합으로 초기 번들 크기 감소
6. **React.memo**: 카드 컴포넌트처럼 자주 렌더링되는 컴포넌트에 적용하면 성능 향상
