# 등록 기능 접속주소 분리 및 마커찍기 개선 플랜

> **통합 문서**: Early Access 시스템 + 등록 위치 선택 개선
>
> **목적**: 다른 AI 또는 새 대화창에서도 전체 맥락을 파악할 수 있도록 정리

---

## 1. 배경 및 목적

### 1.1 Early Access 필요성

**현재 고민**:
1. 사이트 정식 오픈 전 **교원연수 강사 인력풀**을 미리 확보하고 싶음
2. main 미커밋 시: 강사들이 등록할 통로가 없음
3. main 커밋 시: 일반 대중에게 강사 0명 상태로 공개됨 (신뢰도 저하)

**해결 방향**:
- 비밀 URL 경로(`/earlyteacher2026`)로 특정 인원에게만 등록 기능 오픈
- 일반 사용자에게는 "준비 중" 모달 표시
- main 브랜치에 커밋해도 안전하게 베타 테스터/강사 모집 가능

### 1.2 위치 선택 개선 필요성

**현재 문제점**:
1. 등록 버튼 클릭 → 지도에서 위치 찍기 → 모달창
2. 사용자들이 "자기 집"을 찍음
3. 마커로 정확한 위치가 표시되어 **프라이버시 우려**

**해결 방향**:
- 지도 찍기 과정 자체를 제거
- 행정구역(구/읍/면) 검색 선택 방식으로 전환
- 선택된 지역 내 **랜덤 오프셋 좌표** 생성 (±500m)

---

## 2. 변경 개요

### 2.1 등록 플로우 변경

**Before (기존)**:
```
등록 버튼 → 지도에서 위치 찍기 → 모달창 → 등록
```

**After (변경)**:
```
등록 버튼 → 바로 모달창 → 구/읍/면 검색 선택 → 등록 → 마커 위치로 지도 이동
```

### 2.2 기능별 적용 범위

| 기능 | Early Access | 일반 접속 | 위치 선택 방식 |
|------|-------------|----------|---------------|
| **공고등록** | 개방 (기존대로) | 개방 (기존대로) | 지도 찍기 (기존 유지) |
| **구직등록** | 개방 | ComingSoonModal | 구/읍/면 검색 (변경) |
| **강사등록** | 개방 | ComingSoonModal | 구/읍/면 검색 (변경) |

---

## 3. Early Access 시스템

### 3.1 접속 URL 구조

```
일반 접속: https://학교일자리.com
특별 접속: https://학교일자리.com/earlyteacher2026
```

**지원 도메인**:
| 도메인 | Early Access URL |
|--------|------------------|
| 학교일자리.com | `https://학교일자리.com/earlyteacher2026` |
| xn--9d0bk8ucxkkcw59f.com | `https://xn--9d0bk8ucxkkcw59f.com/earlyteacher2026` |
| localhost:5173 | `http://localhost:5173/earlyteacher2026` |

### 3.2 구현된 컴포넌트

#### useEarlyAccess 훅
**파일**: `src/hooks/useEarlyAccess.ts`

```typescript
const EARLY_ACCESS_PATH = '/earlyteacher2026';
const EARLY_ACCESS_STORAGE_KEY = 'earlyAccess';

export function useEarlyAccess(): UseEarlyAccessReturn {
  // 현재 경로가 Early Access 경로인지 확인
  const isEarlyAccessPath = window.location.pathname === EARLY_ACCESS_PATH;

  // localStorage에서 Early Access 상태 로드
  // /earlyteacher2026 경로 접속 시 localStorage에 저장
  // 이후 일반 경로(/)로 접속해도 등록 기능 사용 가능
}
```

**핵심 동작**:
1. `/earlyteacher2026` 경로 접속 시 `localStorage.setItem('earlyAccess', 'true')`
2. 이후 일반 경로(`/`)로 접속해도 `hasEarlyAccess === true`
3. 브라우저 데이터 삭제 전까지 유지

#### main.tsx 라우팅
**파일**: `src/main.tsx`

```typescript
// Early Access 경로 (구직등록/강사등록 사전 개방)
else if (pathname === '/earlyteacher2026') {
  rootComponent = <NewLanding />
}
```

### 3.3 UI 분기 처리

**파일**: `src/pages/new-landing/components/Hero.tsx`

등록 버튼 클릭 시 분기:
```typescript
const { hasEarlyAccess } = useEarlyAccess();

// 구직등록/강사등록 버튼 클릭 핸들러
if (!hasEarlyAccess) {
  // 일반 접속 → ComingSoonModal 표시
  setComingSoonTitle('구직등록');
  setShowComingSoonModal(true);
  return;
}
// Early Access → 실제 등록 모달 열기
```

---

## 4. 위치 선택 개선

### 4.1 RegionSearchInput 컴포넌트

**파일**: `src/components/forms/RegionSearchInput.tsx`

**기능**:
- 카카오맵 API 키워드 검색 활용
- "분당", "기흥" 등 부분 검색어 지원
- 자동 접미사 추가 ("분당" → "분당구"로 검색)
- 검색 결과 캐싱 (성능 최적화)
- 디바운싱 300ms 적용

**데이터 구조**:
```typescript
interface RegionData {
  regionCode: string;      // 행정구역 코드
  regionName: string;      // 표시명 (예: "용인시 기흥구")
  fullAddress: string;     // 전체 주소 (예: "경기도 용인시 기흥구")
}
```

**UI 문구**:
```
거주하시는 지역의 구, 읍, 면 정도만 지정해주세요.
등록마커는 해당 지역 내 임의 장소에 배정됩니다.
```

### 4.2 랜덤 좌표 생성

**파일**: `src/lib/utils/geocoding.ts`

```typescript
/**
 * 주소를 좌표로 변환 (Geocoding)
 * 랜덤 오프셋을 적용하여 정확한 위치 노출 방지 (개인정보 보호)
 *
 * @param address - 전체 주소 문자열 (예: "경기도 용인시 기흥구")
 * @param offsetMeters - 랜덤 오프셋 범위 (미터 단위, 기본값: 500m)
 * @returns Promise<Coordinates> - 랜덤 오프셋이 적용된 좌표
 */
export async function getRandomizedCoordsFromAddress(
  address: string,
  offsetMeters: number = 500
): Promise<Coordinates>
```

**동작 원리**:
1. 카카오맵 `addressSearch`로 주소의 기준 좌표 획득
2. ±500m 범위 내 랜덤 오프셋 생성
3. 실제 저장되는 좌표는 정확한 위치가 아닌 "대략적 지역"

### 4.3 등록 모달 수정

**구직등록 모달**: `src/components/map/TeacherMarkerModal.tsx`
**강사등록 모달**: `src/components/map/InstructorMarkerModal.tsx`

**변경 내용**:
1. `coords`/`address` 상태 → `regionData` 상태로 변경
2. 지도 찍기 관련 코드 제거
3. `RegionSearchInput` 컴포넌트 추가
4. 제출 시 `getRandomizedCoordsFromAddress()` 호출

```typescript
// 모달 상태
const [regionData, setRegionData] = useState<RegionData | null>(null);

// 제출 처리
const handleSubmit = async () => {
  if (!regionData) {
    setError('위치를 선택해주세요.');
    return;
  }

  // 지역 주소 기반 랜덤 좌표 생성 (±500m 오프셋 적용)
  const coords = await getRandomizedCoordsFromAddress(regionData.fullAddress);

  // 마커 등록
  const input: TeacherMarkerInput = {
    latitude: coords.lat,
    longitude: coords.lng,
    // ...
  };
};
```

---

## 5. 구현 진행 상황

### Early Access 시스템
- [x] `useEarlyAccess` 훅 생성
- [x] `main.tsx` 라우터에 `/earlyteacher2026` 경로 추가
- [x] `Hero.tsx` 등록 버튼 핸들러에 분기 추가
- [x] `ComingSoonModal` 연동

### 위치 선택 개선
- [x] `RegionSearchInput.tsx` 컴포넌트 생성
- [x] 카카오맵 API 키워드 검색 연동
- [x] 검색 로직 개선 (부분 검색어 지원)
- [x] `getRandomizedCoordsFromAddress()` 유틸 함수 생성
- [x] `TeacherMarkerModal` 수정 (RegionSearchInput 적용)
- [x] `InstructorMarkerModal` 수정 (RegionSearchInput 적용)
- [x] `Hero.tsx` 수정 (LocationPicker 단계 스킵)
- [x] 등록 완료 후 지도 이동 (기존 onSuccess 활용)

### 테스트
- [ ] `/earlyteacher2026` 접속 후 등록 기능 확인
- [ ] 일반 접속 시 ComingSoonModal 확인
- [ ] 지역 검색 테스트 ("분당", "기흥", "강남" 등)
- [ ] 랜덤 좌표가 선택 지역 근처인지 확인
- [ ] 모바일 반응형 확인

---

## 6. 영향 받는 파일 목록

```
src/
├── hooks/
│   └── useEarlyAccess.ts              (신규) Early Access 상태 관리
├── main.tsx                            (수정) /earlyteacher2026 라우팅 추가
├── pages/
│   └── new-landing/components/
│       └── Hero.tsx                    (수정) 등록 버튼 분기, LocationPicker 스킵
├── components/
│   ├── forms/
│   │   └── RegionSearchInput.tsx      (신규) 지역 검색 입력 컴포넌트
│   ├── map/
│   │   ├── TeacherMarkerModal.tsx     (수정) RegionSearchInput 적용
│   │   └── InstructorMarkerModal.tsx  (수정) RegionSearchInput 적용
│   └── common/
│       └── ComingSoonModal.tsx         (기존) 수정 불필요
└── lib/
    └── utils/
        └── geocoding.ts                (수정) getRandomizedCoordsFromAddress 추가
```

---

## 7. 테스트 가이드

### 7.1 Early Access 테스트

1. **일반 접속 테스트**
   - `http://localhost:5173` 접속
   - 구직등록/강사등록 버튼 클릭 → ComingSoonModal 표시 확인

2. **Early Access 테스트**
   - `http://localhost:5173/earlyteacher2026` 접속
   - 구직등록/강사등록 버튼 클릭 → 실제 등록 모달 열림 확인
   - 이후 `http://localhost:5173`로 접속해도 등록 가능 확인

3. **localStorage 초기화**
   - 개발자도구 → Application → Local Storage → `earlyAccess` 삭제
   - 일반 접속으로 돌아감

### 7.2 위치 선택 테스트

1. **지역 검색 테스트**
   - "분당" 입력 → "성남시 분당구" 결과 표시
   - "기흥" 입력 → "용인시 기흥구" 결과 표시
   - "강남" 입력 → "강남구" 결과 표시

2. **등록 완료 테스트**
   - 지역 선택 후 등록
   - 마커가 선택 지역 근처(±500m)에 생성됨 확인
   - 지도가 해당 마커 위치로 이동 확인

---

## 8. 보안 및 주의사항

### Early Access
- `/earlyteacher2026` 경로는 URL에 노출되므로 민감한 정보 아님
- 로컬스토리지 사용으로 브라우저 재접속 시에도 유지
- 정식 오픈 시 Early Access 관련 코드 전체 제거 필요

### 위치 프라이버시
- 사용자가 입력한 정확한 주소는 저장되지 않음
- 구/읍/면 단위 + 랜덤 오프셋으로 대략적 위치만 표시
- 다른 사용자가 마커를 봐도 정확한 거주지 파악 불가

---

## 9. 향후 계획

| 시점 | 액션 |
|------|------|
| 즉시 | Early Access + 위치 개선 구현 완료, main 배포 |
| 1~2주 | 강사/구직자 사전 모집 (비밀 URL 공유) |
| 2월 중순 | 충분한 데이터 확보 후 일반 공개 |
| 정식 오픈 | Early Access 코드 제거, 전체 공개 |

---

## 10. 강사 모집용 공유 메시지

```
[교원연수 강사 등록 안내]

안녕하세요, 학교일자리입니다.
교원연수 강사 인력풀에 등록을 원하시면
아래 링크로 접속해주세요.

학교일자리.com/earlyteacher2026

* 현직 교사도 등록 가능합니다.
* 정식 오픈 전 사전 등록자 혜택이 있습니다.
```

---

**작성일**: 2026-01-30
**버전**: 1.0 (통합본)
**프로젝트**: SellmeBuyme (학교일자리)
