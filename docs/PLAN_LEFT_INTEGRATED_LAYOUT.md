# 공고목록 필터 좌측 통합 및 상세 패널 개선 플랜

> 작성일: 2026-01-11
> 작성자: Claude Code

---

## 1. 현황 분석

### 1.1 현재 셀미바이미 레이아웃 문제점

```
현재 레이아웃:
┌─────────────────────────────────────────────────────────────────┐
│ [헤더]                                                          │
├───────────────┬────────────────────────┬───────────────────────┤
│ [공고 목록]   │                        │     [지도 필터]        │
│  (1열 배치)   │       [지도 영역]       │   - 주소 검색         │
│               │                        │   - 학교급           │
│  카드1        │                        │   - 유형 (불필요)     │
│  카드2        │                        │   - 과목             │
│  카드3        │                        │                      │
│  (빈 공간 多)  │                        │                      │
└───────────────┴────────────────────────┴───────────────────────┘
```

| 문제 | 설명 |
|------|------|
| **상세모달 미작동** | 카드/마커 클릭 시 상세 정보 볼 수 없음 |
| **동일 공고 중복** | 같은 학교의 같은 공고가 여러 번 표시 |
| **필터 위치 비효율** | 오른쪽 필터로 인해 공간 낭비 |
| **카드 1열 배치** | 불필요한 빈 공간, 스크롤 증가 |
| **유형 필터 무의미** | 실질적 필터링 효과 없음 |

### 1.2 네이버 지도 UI/UX 패턴 분석

```
네이버 지도 레이아웃:
┌─────────────────────────────────────────────────────────────────┐
│ [헤더 - 검색바]                                                  │
├─────────────┬──────────────┬───────────────────────────────────┤
│ [검색 결과] │ [상세 패널]   │                                    │
│  (목록)     │  (서랍형)    │           [지도 영역]               │
│             │              │                                    │
│  항목1      │  기관명      │           (마커들)                  │
│  항목2      │  상세정보    │                                    │
│  항목3      │  액션버튼    │                                    │
│             │              │                                    │
└─────────────┴──────────────┴───────────────────────────────────┘
```

**네이버 핵심 패턴:**
1. **왼쪽 통합**: 검색 + 필터 + 목록이 모두 왼쪽
2. **서랍형 상세 패널**: 목록 클릭 시 목록 옆에 상세 패널이 슬라이드로 열림
3. **지도 자동 이동**: 상세 패널이 열릴 때 마커가 가려지지 않도록 지도 중심 이동
4. **목록-마커 연동**: 목록 클릭 = 마커 클릭, 동일한 결과

---

## 2. 개선 목표

### 2.1 핵심 목표
1. **상세 패널 연동**: 카드/마커 클릭 시 상세 정보 표시
2. **레이아웃 최적화**: 필터 왼쪽 통합, 카드 2열 배치
3. **중복 공고 제거**: 동일 기관+제목 공고 필터링

### 2.2 목표 레이아웃

```
개선된 레이아웃:
┌─────────────────────────────────────────────────────────────────────────────┐
│ [헤더 - 로고, 알림 버튼]                                                      │
├────────────────────────┬──────────────────────┬─────────────────────────────┤
│ [필터 영역]            │                      │                             │
│ ┌──────────────────┐  │                      │                             │
│ │ 주소 검색 [____] │  │                      │                             │
│ │ 학교급: 유 초 중 고│  │    [상세 패널]        │                             │
│ │ 과목: 국 영 수 ...│  │    (서랍형)          │        [지도 영역]           │
│ └──────────────────┘  │    ┌────────────┐   │                             │
│                       │    │ 기관명      │   │         (마커들)            │
│ [공고 목록 - 2열]      │    │ 공고제목    │   │                             │
│ ┌────────┬────────┐  │    │ 위치        │   │                             │
│ │ 카드1  │ 카드2  │  │    │ 보수        │   │                             │
│ ├────────┼────────┤  │    │ 마감일      │   │                             │
│ │ 카드3  │ 카드4  │  │    │ 근무기간    │   │                             │
│ ├────────┼────────┤  │    │ 연락처      │   │                             │
│ │ 카드5  │ 카드6  │  │    │ 태그        │   │                             │
│ └────────┴────────┘  │    │ [원문링크]  │   │                             │
│                       │    └────────────┘   │                             │
└────────────────────────┴──────────────────────┴─────────────────────────────┘

폭 비율: 공고목록(25%) - 상세패널(20%) - 지도(55%)
상세패널 닫힘 시: 공고목록(25%) - 지도(75%)
```

---

## 3. 상세 패널 설계

### 3.1 상세 패널 컴포넌트 (JobDetailPanel)

```tsx
interface JobDetailPanelProps {
  job: JobPostingCard | null;
  isOpen: boolean;
  onClose: () => void;
  onViewOnMap: (job: JobPostingCard) => void;
}
```

### 3.2 상세 패널 내용

```
┌──────────────────────────────────────┐
│ [X 닫기]                    [D-3]   │
├──────────────────────────────────────┤
│ 기관명                               │
│ ═══════════════════════════════════ │
│ 공고 제목 (굵게, 큰 폰트)              │
│                                      │
│ ────────────────────────────────── │
│ 📍 위치: 서울특별시 강남구...         │
│ 💰 보수: 월급 3,500,000원            │
│ 📅 마감일: 2026-01-15               │
│ 📆 근무기간: 2026.03 ~ 2026.08      │
│ 📋 접수기간: 2026.01.10 ~ 01.15     │
│ 📞 연락처: 02-1234-5678              │
│ ────────────────────────────────── │
│                                      │
│ 태그: [수학] [기간제] [중학교]        │
│                                      │
│ ┌────────────────────────────────┐ │
│ │       [원문 링크 바로가기]        │ │
│ └────────────────────────────────┘ │
│ ┌────────────────────────────────┐ │
│ │         [지도에서 보기]          │ │
│ └────────────────────────────────┘ │
└──────────────────────────────────────┘
```

### 3.3 상세 패널 트리거

| 트리거 | 동작 |
|--------|------|
| 카드 클릭 | 상세 패널 열기 + 지도 이동 + 마커 하이라이트 |
| 마커 클릭 | 상세 패널 열기 + 해당 카드 하이라이트 |
| X 버튼 | 상세 패널 닫기 |
| 패널 외부 클릭 | 상세 패널 닫기 (선택적) |

### 3.4 지도 자동 이동 로직

```typescript
// 상세 패널이 열릴 때 지도 중심 조정
const adjustMapForPanel = (markerPosition: LatLng, panelWidth: number) => {
  const map = mapInstanceRef.current;
  if (!map) return;

  // 마커가 패널에 가려지지 않도록 오른쪽으로 이동
  const offsetLng = panelWidth * 0.00003; // 픽셀을 경도로 변환 (근사값)
  const newCenter = new kakao.maps.LatLng(
    markerPosition.getLat(),
    markerPosition.getLng() + offsetLng
  );

  map.panTo(newCenter);
};
```

---

## 4. 동일 공고 중복 제거

### 4.1 문제 원인

- 크롤러가 `source_url` 기준으로만 중복 체크
- 같은 학교에서 연속 날짜에 같은 공고를 올리면 별개 URL로 저장
- 예: "군산중앙중학교 - 기술, 가정 기간제 교사" 5건 표시

### 4.2 해결 방안

#### Option A: DB 쿼리 레벨 (권장)

```sql
-- 같은 기관+제목 공고 중 최신 것만 선택
SELECT DISTINCT ON (organization, title) *
FROM job_postings
WHERE region_boards @> ARRAY['board_id_here']::uuid[]
ORDER BY organization, title, created_at DESC;
```

#### Option B: 프론트엔드 필터링

```typescript
const deduplicateJobs = (jobs: JobPostingCard[]) => {
  const seen = new Map<string, JobPostingCard>();

  for (const job of jobs) {
    const key = `${job.organization}|${job.title}`;
    const existing = seen.get(key);

    if (!existing || new Date(job.created_at) > new Date(existing.created_at)) {
      seen.set(key, job);
    }
  }

  return Array.from(seen.values());
};
```

#### Option C: 크롤러 개선 (장기)

```javascript
// 크롤러에서 중복 체크 강화
const isDuplicate = await supabase
  .from('job_postings')
  .select('id')
  .eq('organization', job.organization)
  .eq('title', job.title)
  .gte('created_at', oneWeekAgo)
  .single();

if (isDuplicate) {
  // 기존 레코드 업데이트
} else {
  // 새 레코드 삽입
}
```

### 4.3 권장 구현

**단기**: Option B (프론트엔드 필터링) - 즉시 적용 가능
**장기**: Option A (DB 쿼리) + Option C (크롤러 개선)

---

## 5. 레이아웃 재구성

### 5.1 필터 이동

**Before (Hero.tsx 현재):**
```tsx
<section className="flex gap-4">
  {/* 왼쪽: 공고 목록 */}
  <div className="w-[400px]">...</div>

  {/* 중앙: 지도 */}
  <div className="flex-1">...</div>

  {/* 오른쪽: 필터 */}
  <div className="w-[280px]">...</div>
</section>
```

**After:**
```tsx
<section className="flex gap-4">
  {/* 왼쪽: 필터 + 공고 목록 */}
  <div className="w-[400px] flex flex-col">
    {/* 필터 (상단) */}
    <div className="bg-white rounded-lg p-4 mb-4">
      {/* 주소 검색, 학교급, 과목 필터 */}
    </div>

    {/* 공고 목록 (2열) */}
    <div className="flex-1 overflow-y-auto">
      <div className="grid grid-cols-2 gap-2">
        {filteredJobs.map(job => <MiniCard key={job.id} />)}
      </div>
    </div>
  </div>

  {/* 상세 패널 (조건부 렌더링) */}
  {selectedJob && (
    <JobDetailPanel
      job={selectedJob}
      onClose={() => setSelectedJob(null)}
    />
  )}

  {/* 지도 */}
  <div className="flex-1">...</div>
</section>
```

### 5.2 유형 필터 제거

현재 유형 필터: 기간제, 교사, 시간강사, 강사, 기타
- 실질적 필터링 효과 미미
- 다른 필터(학교급, 과목)로 충분히 커버
- 제거하여 UI 단순화

### 5.3 카드 2열 배치

```tsx
// 기존: 1열 배치
<div className="space-y-3">
  {jobs.map(job => <Card />)}
</div>

// 개선: 2열 배치
<div className="grid grid-cols-2 gap-2">
  {jobs.map(job => <CompactCard />)}
</div>
```

**카드 크기 조정:**
- 기존: width 100%, height ~150px
- 개선: width 50%, height ~120px
- 정보: 기관명, 제목(1줄), 마감일, 태그(2개)

---

## 6. 구현 우선순위

| 우선순위 | 항목 | 설명 | 예상 난이도 |
|---------|------|------|------------|
| **P0** | 상세 패널 구현 | JobDetailPanel 컴포넌트 + state 연동 | 중 |
| **P0** | 카드 클릭 연동 | setSelectedJob(job) 호출 | 하 |
| **P0** | 마커 클릭 연동 | 커스텀 이벤트로 React 연동 | 중 |
| **P1** | 필터 왼쪽 이동 | 레이아웃 재구성 | 중 |
| **P1** | 유형 필터 제거 | UI 단순화 | 하 |
| **P1** | 카드 2열 배치 | 그리드 레이아웃 변경 | 하 |
| **P2** | 중복 공고 필터링 | 프론트엔드 deduplication | 하 |
| **P3** | 지도 자동 이동 | panTo() 로직 추가 | 중 |
| **P3** | 마커-카드 하이라이트 | 양방향 하이라이트 연동 | 중 |

---

## 7. 파일 수정 계획

### 7.1 Hero.tsx 수정

```typescript
// 추가할 state
const [selectedJob, setSelectedJob] = useState<JobPostingCard | null>(null);

// 카드 클릭 핸들러 수정 (기존: 지도 이동만)
onClick={() => {
  setSelectedJob(job);  // 상세 패널 열기
  moveMapToJob(job);    // 지도 이동
}}

// 마커 클릭 이벤트 연동
kakao.maps.event.addListener(marker, 'click', () => {
  setSelectedJob(job);
});
```

### 7.2 JobDetailPanel.tsx 신규 생성

```typescript
// src/pages/new-landing/components/JobDetailPanel.tsx
export const JobDetailPanel: React.FC<JobDetailPanelProps> = ({
  job,
  onClose,
  onViewOnMap,
}) => {
  if (!job) return null;

  return (
    <div className="w-[280px] bg-white rounded-lg shadow-lg p-4 overflow-y-auto">
      {/* 헤더 */}
      {/* 상세 정보 */}
      {/* 액션 버튼 */}
    </div>
  );
};
```

### 7.3 queries.ts 수정 (옵션)

```typescript
// 중복 제거 쿼리 추가
export const fetchJobsWithDeduplication = async (boardIds: string[]) => {
  // DISTINCT ON 쿼리 또는 post-processing
};
```

---

## 8. 텍스트 목업

### 8.1 상세 패널 닫힌 상태

```
┌────────────────────────────────────────────────────────────────────┐
│  쌤찾기z     나에게 딱 맞는 학교 공고, 놓치지 말고...    [무료 알림] │
├────────────────────────┬───────────────────────────────────────────┤
│ ┌──────────────────┐  │                                           │
│ │ 주소검색 [서울__] │  │                                           │
│ └──────────────────┘  │                                           │
│ 학교급: [유][초][중][고]│                                           │
│ 과목: [국][영][수][사]..│           [지도 영역]                     │
│ ──────────────────── │                                           │
│ 공고 목록    23개     │              ● 마커1                       │
│ ┌────────┬────────┐  │          ● 마커2                          │
│ │정원여중 │양동중   │  │       ● 마커3                             │
│ │기간제   │스포츠강사│  │                                           │
│ │D-11    │D-22    │  │                                           │
│ ├────────┼────────┤  │                                           │
│ │한신초   │홍익부여고│  │                                           │
│ │중국어   │배식실무사│  │                                           │
│ │D-18    │D-19    │  │                                           │
│ └────────┴────────┘  │                                           │
└────────────────────────┴───────────────────────────────────────────┘
```

### 8.2 상세 패널 열린 상태

```
┌──────────────────────────────────────────────────────────────────────────┐
│  쌤찾기z     나에게 딱 맞는 학교 공고, 놓치지 말고...       [무료 알림]  │
├──────────────────┬──────────────────┬────────────────────────────────────┤
│ [필터 - 축소]    │ [상세 패널]       │                                    │
│ ────────────── │ ┌──────────────┐ │                                    │
│ 공고 목록  23개  │ │ [X]     D-11 │ │                                    │
│ ┌──────┬──────┐│ │              │ │         [지도 영역]                 │
│ │카드1 │카드2 ││ │ 정원여자중학교 │ │                                    │
│ │      │(선택)││ │ ════════════ │ │              ● (하이라이트)         │
│ ├──────┼──────┤│ │ 기간제교사    │ │                                    │
│ │카드3 │카드4 ││ │              │ │                                    │
│ ├──────┼──────┤│ │ 📍 서대문구   │ │                                    │
│ │카드5 │카드6 ││ │ 💰 월급여     │ │                                    │
│ └──────┴──────┘│ │ 📅 ~01.11    │ │                                    │
│                │ │ [과학] [수학] │ │                                    │
│                │ │              │ │                                    │
│                │ │ [원문 링크]   │ │                                    │
│                │ └──────────────┘ │                                    │
└──────────────────┴──────────────────┴────────────────────────────────────┘
```

---

## 9. 결론

### 9.1 핵심 변경 사항

1. **상세 패널 추가**: 카드/마커 클릭 시 서랍형 상세 패널 열기
2. **레이아웃 통합**: 필터를 왼쪽으로 이동, 공고목록 상단 배치
3. **카드 2열 배치**: 공간 효율성 향상
4. **유형 필터 제거**: UI 단순화
5. **중복 공고 제거**: 동일 기관+제목 필터링

### 9.2 기대 효과

| 항목 | 현재 | 개선 후 |
|------|------|--------|
| 상세 정보 접근 | 원문 링크 클릭 필요 | 클릭 즉시 확인 |
| 공간 효율 | 1열 카드 + 빈 공간 | 2열 카드 + 상세 패널 |
| 중복 표시 | 동일 공고 5건 표시 | 1건으로 통합 |
| 필터 접근성 | 오른쪽 별도 영역 | 공고목록 상단 통합 |

### 9.3 네이버 지도와의 일관성

- 목록 클릭 → 상세 패널 열림 (동일)
- 마커 클릭 → 상세 패널 열림 (동일)
- 지도 자동 이동 (동일 패턴 적용)
- 왼쪽 통합 레이아웃 (동일)

---

## 부록: 참고 스크린샷

1. `naver-map-list.png` - 네이버 지도 목록 UI
2. `naver-map-detail-panel.png` - 네이버 지도 상세 패널
3. 사용자 제공 스크린샷 1-4

경로: `.playwright-mcp/` 디렉토리
