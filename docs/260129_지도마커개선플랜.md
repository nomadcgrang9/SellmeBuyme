# 지도 마커 개선 플랜

**작성일**: 2026-01-29
**작성자**: Claude Code
**목표**: 마커 등록 후 즉시 표시, UI 일관성 개선, 성능 최적화

---

## 1. 현재 상태 분석

### 1.1 문제점

1. **마커 등록 후 즉시 표시 안됨**
   - 구직/공고/교원연수 마커 등록 후 새로고침해야 보임
   - `loadMarkerData()` 호출되지만 state 업데이트가 UI에 즉시 반영 안됨

2. **교원연수 마커 필터 조건 문제** (해결됨)
   - 기존: `cascadingFilter.primary === '교원연수'` 일 때만 표시
   - 수정: 필터 없거나 '교원연수' 선택 시 표시, 다른 필터 선택 시 숨김

3. **마커 디자인 불일치** (해결됨)
   - 기존: 교원연수 마커는 단순 원형
   - 수정: 구직 마커와 동일한 사람 아이콘 + 핑크색 적용

### 1.2 현재 데이터 플로우

```
[등록 모달]
    ↓ createMarker()
[Supabase DB]
    ↓ onSuccess()
[loadMarkerData()]
    ↓ fetch*Markers()
[setState]
    ↓ useEffect 의존성 트리거
[카카오맵 마커 렌더링]
```

---

## 2. 완료된 개선 사항

### 2.1 교원연수 마커 사람 아이콘 적용

**파일**: `src/lib/constants/markerColors.ts`

```typescript
export const INSTRUCTOR_MARKER_SIZE = {
  width: 28,
  height: 28,
  radius: 12,
  centerX: 14,
  centerY: 14,
} as const;

export function generateInstructorMarkerSVG(color: string = '#F9A8D4'): string {
  // 구직 마커와 동일한 사람 아이콘 + 핑크색
}
```

### 2.2 교원연수 마커 필터 로직 개선

**파일**: `src/pages/new-landing/components/Hero.tsx`

```typescript
// 기존: '교원연수' 필터 필수
if (cascadingFilter.primary !== '교원연수') return;

// 수정: 필터 없음 또는 '교원연수' 시 표시
if (cascadingFilter.primary && cascadingFilter.primary !== '교원연수') return;
```

### 2.3 교원연수 강사만 보기 버튼 추가

**파일**: `src/components/map/LayerToggleBar.tsx`

- "교원연수 강사만 보기" 토글 버튼 추가
- 클릭 시 필터바 '교원연수' 자동 선택

---

## 3. 추가 개선 방안 (권장)

### 3.1 Supabase Realtime 구독 적용 (권장)

**문제**: 마커 등록 후 새로고침 필요
**해결**: Supabase Realtime으로 DB 변경 즉시 감지

#### 구현 방안

```typescript
// src/hooks/useRealtimeMarkers.ts
import { useEffect } from 'react';
import { supabase } from '@/lib/supabase/client';

export function useRealtimeMarkers(
  onInstructorChange: (payload: any) => void
) {
  useEffect(() => {
    const channel = supabase
      .channel('instructor_markers_changes')
      .on(
        'postgres_changes',
        {
          event: '*', // INSERT, UPDATE, DELETE
          schema: 'public',
          table: 'instructor_markers'
        },
        (payload) => {
          console.log('[Realtime] instructor_markers 변경:', payload);
          onInstructorChange(payload);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [onInstructorChange]);
}
```

#### Hero.tsx 적용

```typescript
// Realtime 콜백
const handleInstructorRealtimeChange = useCallback((payload: any) => {
  if (payload.eventType === 'INSERT') {
    setInstructorMarkers(prev => [...prev, payload.new]);
  } else if (payload.eventType === 'DELETE') {
    setInstructorMarkers(prev =>
      prev.filter(m => m.id !== payload.old.id)
    );
  } else if (payload.eventType === 'UPDATE') {
    setInstructorMarkers(prev =>
      prev.map(m => m.id === payload.new.id ? payload.new : m)
    );
  }
}, []);

// 훅 사용
useRealtimeMarkers(handleInstructorRealtimeChange);
```

#### Supabase 설정 필요

1. Supabase 대시보드 → Database → Replication
2. `instructor_markers` 테이블 Realtime 활성화
3. `teacher_markers`, `program_markers` 테이블도 동일하게 적용

### 3.2 마커 클러스터링 (대용량 대비)

마커가 많아질 경우를 대비한 성능 최적화

**참고**: [react-kakao-maps-sdk MarkerClusterer](https://react-kakao-maps-sdk.jaeseokim.dev/)

```typescript
// 클러스터링 라이브러리 로드 필요
<MarkerClusterer
  averageCenter={true}
  minLevel={8}
>
  {markers.map(marker => (
    <MapMarker key={marker.id} position={...} />
  ))}
</MarkerClusterer>
```

### 3.3 Viewport 기반 렌더링 (성능 최적화)

현재 보이는 영역의 마커만 렌더링

```typescript
const visibleMarkers = useMemo(() => {
  if (!viewportBounds) return markers;
  return markers.filter(m =>
    m.latitude >= viewportBounds.south &&
    m.latitude <= viewportBounds.north &&
    m.longitude >= viewportBounds.west &&
    m.longitude <= viewportBounds.east
  );
}, [markers, viewportBounds]);
```

---

## 4. 외부 리소스 조사 결과

### 4.1 skills.cokac.com

- 지도 관련 특화 스킬 없음
- **Vercel React Best Practices** 스킬이 성능 최적화에 간접적으로 유용

### 4.2 claudemarketplaces.com

- 지도/마커 특화 플러그인 없음
- **bd28/claude-automation**: Supabase 통합 포함 (잠재적 유용)

### 4.3 관련 라이브러리

| 라이브러리 | 용도 | 링크 |
|-----------|------|------|
| react-kakao-maps-sdk | React + Kakao Map 통합 | [GitHub](https://github.com/JaeSeoKim/react-kakao-maps-sdk) |
| Supabase Realtime | 실시간 DB 변경 감지 | [Docs](https://supabase.com/docs/guides/realtime/subscribing-to-database-changes) |

---

## 5. 구현 우선순위

| 우선순위 | 항목 | 복잡도 | 예상 효과 |
|---------|------|--------|----------|
| 1 | Supabase Realtime 적용 | 중 | 마커 즉시 표시 |
| 2 | 마커 클러스터링 | 중 | 대용량 성능 개선 |
| 3 | Viewport 기반 렌더링 | 하 | 렌더링 성능 개선 |

---

## 6. 테스트 체크리스트

- [ ] 교원연수 마커 등록 후 즉시 표시 확인
- [ ] 구직 마커 등록 후 즉시 표시 확인
- [ ] 공고 마커 등록 후 즉시 표시 확인
- [ ] 교원연수 마커 사람 아이콘 + 핑크색 확인
- [ ] "교원연수 강사만 보기" 버튼 동작 확인
- [ ] 필터 해제 시 교원연수 마커 표시 확인
- [ ] 다른 필터(유치원, 초등담임 등) 선택 시 교원연수 마커 숨김 확인

---

## 7. 참고 자료

- [Supabase Realtime - Database Changes](https://supabase.com/docs/guides/realtime/subscribing-to-database-changes)
- [react-kakao-maps-sdk Documentation](https://react-kakao-maps-sdk.jaeseokim.dev/)
- [Real-time Table Changes in Supabase with React.js](https://www.codu.co/niall/real-time-table-changes-in-supabase-with-react-js-next-js-swmgqmq9)
- [How Supabase Realtime Powers Live Updates](https://www.rocket.new/blog/how-to-use-supabase-realtime-for-live-app-updates-fast-toda)
