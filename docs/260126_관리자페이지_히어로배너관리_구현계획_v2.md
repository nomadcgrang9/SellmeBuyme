# 관리자 페이지 - 히어로 배너 관리 구현 계획 (v2)

**작성일**: 2026-01-26
**목표**: 홍보카드 관리 섹션 내에 히어로 배너 관리 추가

---

## 1. 현황 분석

### 1.1 홍보카드 관리 페이지 구조

**파일**: `src/components/admin/PromoTabManager.tsx`

현재 구조:
```tsx
<div className="space-y-4">
  {/* 현재는 준비 중 메시지만 표시 */}
  {/* 향후 여러 섹션 추가 예정 */}

  {/* 주석 처리된 기존 컴포넌트 */}
  {false && <PromoCardEditSection />}      // 프로모 카드 편집
  {false && <StripeBannerManager />}        // 띠지배너 관리
</div>
```

### 1.2 기존 섹션 레이아웃 패턴 (StripeBannerManager 참고)

```
┌─────────────────────────────────────────────────────────────┐
│  ▼ 띠지배너 관리                               [활성화] [...] │
│     메인페이지 상단의 통계, 인기키워드, 배너를 관리합니다.    │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [모두 저장 버튼 - 우측 정렬]                                │
│                                                               │
│  ┌─────────────────────────────┬──────────────────────────┐ │
│  │  편집 폼                    │  미리보기                │ │
│  │  (좌측)                     │  (우측)                  │ │
│  │                             │                          │ │
│  │  ┌──────────────────────┐  │  ┌────────────────────┐ │ │
│  │  │ 기본 설정            │  │  │ 실제 페이지        │ │ │
│  │  │  - 활성화            │  │  │ 미리보기           │ │ │
│  │  │  - 회전 속도         │  │  │                    │ │ │
│  │  └──────────────────────┘  │  └────────────────────┘ │ │
│  │                             │                          │ │
│  │  ┌──────────────────────┐  │  ┌────────────────────┐ │ │
│  │  │ 통계 설정            │  │  │ 배너 관리          │ │ │
│  │  │  - 자동/수동         │  │  │  - 탭 선택         │ │ │
│  │  └──────────────────────┘  │  │  - 필드 편집       │ │ │
│  │                             │  └────────────────────┘ │ │
│  │  ┌──────────────────────┐  │                          │ │
│  │  │ 키워드 설정          │  │                          │ │
│  │  └──────────────────────┘  │                          │ │
│  └─────────────────────────────┴──────────────────────────┘ │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

**핵심 패턴**:
1. 접을 수 있는(collapsible) 카드 형태
2. 헤더: 제목 + 설명 + 상태 배지
3. 2단 그리드: 편집 폼(좌) + 미리보기/관리(우)
4. 각 설정 그룹은 `rounded-xl border bg-slate-50/60` 섹션으로 구분

### 1.3 데이터베이스

- **테이블**: `hero_banners`, `hero_banner_config`
- **Supabase 함수**: `src/lib/supabase/hero-banner.ts`에 CRUD 함수 구현됨
- **타입**: `src/types/hero-banner.ts`

---

## 2. 구현 목표

`PromoTabManager.tsx` 내에 **히어로 배너 관리 섹션**을 추가:

```tsx
<div className="space-y-4">
  <HeroBannerManager />      // ✅ 추가할 컴포넌트
  <StripeBannerManager />
  <PromoCardEditSection />
  {/* 향후 다른 섹션들 추가 가능 */}
</div>
```

---

## 3. UI 설계

### 3.1 히어로배너 관리 섹션 (HeroBannerManager)

```
┌─────────────────────────────────────────────────────────────┐
│  ▼ 히어로배너 관리                             [활성화] [...] │
│     공고 목록 왼쪽 패널 상단 배너를 관리합니다.              │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [모두 저장]                                                 │
│                                                               │
│  ┌─────────────────────────────┬──────────────────────────┐ │
│  │  편집 폼 (좌)               │  미리보기 + 배너 목록 (우)│ │
│  │                             │                          │ │
│  │  ┌──────────────────────┐  │  ┌────────────────────┐ │ │
│  │  │ 기본 설정            │  │  │ 실제 배너 미리보기 │ │ │
│  │  │ ───────────────────  │  │  │ ┌────────────────┐ │ │ │
│  │  │ [✓] 배너 시스템 활성화│  │  │ │설문참여해서    │ │ │ │
│  │  │                      │  │  │ │커피쿠폰 받기→  │ │ │ │
│  │  │ 회전 속도: [5]초     │  │  │ └────────────────┘ │ │ │
│  │  └──────────────────────┘  │  └────────────────────┘ │ │
│  │                             │                          │ │
│  │                             │  ┌────────────────────┐ │ │
│  │                             │  │ 배너 목록          │ │ │
│  │                             │  │ ─────────────────  │ │ │
│  │                             │  │ [+ 새 배너]        │ │ │
│  │                             │  │                    │ │ │
│  │                             │  │ ┌──────────────┐  │ │ │
│  │                             │  │ │ [배너 #1] [편집]│ │ │
│  │                             │  │ │ 제목: 설문...  │ │ │
│  │                             │  │ │ 색상: ■ 파랑   │ │ │
│  │                             │  │ │ [✓] 활성       │ │ │
│  │                             │  │ └──────────────┘  │ │ │
│  │                             │  │                    │ │ │
│  │                             │  │ ┌──────────────┐  │ │ │
│  │                             │  │ │ [배너 #2] [편집]│ │ │
│  │                             │  │ │ 제목: 공고...  │ │ │
│  │                             │  │ │ 색상: ■ 녹색   │ │ │
│  │                             │  │ [ ] 비활성     │ │ │
│  │                             │  │ └──────────────┘  │ │ │
│  │                             │  └────────────────────┘ │ │
│  └─────────────────────────────┴──────────────────────────┘ │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 배너 편집 모달

```
┌──────────────────────────────────────────┐
│  배너 편집                       [X]      │
├──────────────────────────────────────────┤
│                                           │
│  제목 *                                   │
│  ┌─────────────────────────────────────┐ │
│  │ 설문참여해서 커피쿠폰 받기 →        │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  부제목 (선택)                            │
│  ┌─────────────────────────────────────┐ │
│  │                                      │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  배경색 *                                 │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │ ■ 파랑  │  │ ■ 레드  │  │ 커스텀  │ │
│  │ #3B82F6 │  │ #F87171 │  │ #______ │ │
│  └─────────┘  └─────────┘  └─────────┘ │
│                                           │
│  텍스트 색상 *                            │
│  ┌─────────┐  ┌─────────┐               │
│  │ ■ 흰색  │  │ ■ 검정  │               │
│  │ #FFFFFF │  │ #1F2937 │               │
│  └─────────┘  └─────────┘               │
│                                           │
│  링크 URL (선택)                          │
│  ┌─────────────────────────────────────┐ │
│  │ https://forms.gle/...                │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  표시 순서 *                              │
│  ┌─────────────────────────────────────┐ │
│  │ 1                                    │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  [✓] 활성화                               │
│                                           │
│  ───────────────────────────────────────│
│                                           │
│  미리보기:                                │
│  ┌────────────────────────────────────┐ │
│  │ 설문참여해서 커피쿠폰 받기 →       │ │
│  └────────────────────────────────────┘ │
│                                           │
│         [취소]           [저장]           │
└──────────────────────────────────────────┘
```

---

## 4. 컴포넌트 구조

### 4.1 파일 구조

```
src/
├── components/
│   └── admin/
│       ├── PromoTabManager.tsx           # 수정: HeroBannerManager 추가
│       ├── HeroBannerManager.tsx         # 신규: 메인 섹션
│       ├── HeroBannerEditModal.tsx       # 신규: 편집 모달
│       ├── StripeBannerManager.tsx       # 기존 (참고용)
│       └── PromoCardEditSection.tsx      # 기존 (참고용)
└── lib/
    └── supabase/
        └── hero-banner.ts                # 기존 (CRUD 함수)
```

### 4.2 컴포넌트 계층

```
PromoTabManager
  ├─ HeroBannerManager (신규)
  │    ├─ 헤더 (접기/펼치기)
  │    ├─ 좌측: 기본 설정 폼
  │    └─ 우측:
  │         ├─ HeroBannerPreview (실시간 미리보기)
  │         └─ 배너 목록 + 간단 편집
  │              └─ HeroBannerEditModal (상세 편집)
  ├─ StripeBannerManager (기존)
  └─ PromoCardEditSection (기존)
```

---

## 5. 주요 기능

### 5.1 관리 기능
1. **전역 설정**:
   - 배너 시스템 활성화/비활성화
   - 회전 속도 (초 단위)

2. **배너 CRUD**:
   - 새 배너 추가
   - 배너 수정 (제목, 부제목, 색상, 링크, 순서, 활성화)
   - 배너 삭제
   - 배너 활성화/비활성화 토글

3. **미리보기**:
   - 실시간 배너 미리보기 (실제 HeroCard 스타일)
   - 캐러셀 동작 확인

### 5.2 제외 기능
- ~~아이콘 선택~~ (불필요)
- ~~드래그 앤 드롭 순서 변경~~ (displayOrder 숫자로 관리)
- ~~이미지 업로드~~ (텍스트 배너만)

---

## 6. 데이터 필드

### 6.1 HeroBanner

| 필드 | 타입 | 필수 | 설명 | 편집 가능 |
|------|------|------|------|----------|
| id | string | ✓ | UUID | - |
| title | string | ✓ | 제목 | ✓ |
| subtitle | string | | 부제목 | ✓ |
| bgColor | string | ✓ | 배경색 (HEX) | ✓ |
| textColor | string | ✓ | 텍스트 색 (HEX) | ✓ |
| linkUrl | string | | 클릭 시 URL | ✓ |
| icon | string | | ~~아이콘~~ | ✗ (제외) |
| displayOrder | number | ✓ | 표시 순서 | ✓ |
| isActive | boolean | ✓ | 활성화 | ✓ |
| createdAt | timestamp | ✓ | 생성일 | - |
| updatedAt | timestamp | ✓ | 수정일 | - |

### 6.2 HeroBannerConfig

| 필드 | 타입 | 필수 | 설명 | 편집 가능 |
|------|------|------|------|----------|
| id | string | ✓ | UUID | - |
| isActive | boolean | ✓ | 전체 활성화 | ✓ |
| rotationSpeed | number | ✓ | 회전 속도 (초) | ✓ |
| createdAt | timestamp | ✓ | 생성일 | - |
| updatedAt | timestamp | ✓ | 수정일 | - |

---

## 7. 구현 단계

### Phase 1: 기본 구조 및 데이터 로드 (1.5시간)
- [ ] `HeroBannerManager.tsx` 생성
  - StripeBannerManager 구조 참고
  - 접기/펼치기 헤더
  - 2단 그리드 레이아웃
- [ ] Supabase 데이터 로드
  - `getHeroBannerConfig()`
  - `getAllBanners()` (활성+비활성 모두)
- [ ] 상태 관리 (`useState`)
  - config, banners, loading, saving
- [ ] `PromoTabManager.tsx` 수정
  - `HeroBannerManager` 추가
  - 준비 중 메시지 제거

### Phase 2: 기본 설정 UI (1시간)
- [ ] 좌측 편집 폼
  - 배너 시스템 활성화 체크박스
  - 회전 속도 입력 필드
- [ ] 설정 저장 기능
  - `handleConfigUpdate()`
  - 토스트 알림

### Phase 3: 배너 목록 및 간단 편집 (2시간)
- [ ] 우측 배너 목록 UI
  - 배너 카드 표시
  - 활성화 토글
  - 순서 표시
- [ ] 배너 추가/삭제 기능
  - `handleAddBanner()`
  - `handleDeleteBanner()`
- [ ] 간단 편집 (인라인)
  - 제목 수정
  - 활성화 토글

### Phase 4: 상세 편집 모달 (2시간)
- [ ] `HeroBannerEditModal.tsx` 생성
  - 모달 레이아웃
  - 입력 폼 (제목, 부제목, 색상, 링크, 순서)
- [ ] 컬러 피커 (프리셋 + 커스텀)
  - `ColorInputField` 재사용
- [ ] 실시간 미리보기
  - 모달 내부에 작은 미리보기
- [ ] 저장 기능
  - `handleBannerUpdate()`

### Phase 5: 메인 미리보기 (1.5시간)
- [ ] `HeroBannerPreview` 컴포넌트
  - 실제 HeroCard 스타일 재현
  - 회전 기능 (config.rotationSpeed 반영)
  - 현재 활성 배너만 표시

### Phase 6: 통합 및 테스트 (1시간)
- [ ] HeroCard.tsx DB 연동 활성화
  - 주석 해제
  - DEFAULT_BANNER fallback 유지
- [ ] 엣지 케이스 처리
  - 배너 0개일 때
  - 모든 배너 비활성일 때
- [ ] UI/UX 개선
  - 로딩 상태
  - 에러 처리
  - 확인 모달

**총 예상 시간**: 9시간

---

## 8. 코드 스타일 가이드

### 8.1 StripeBannerManager 패턴 따르기

```tsx
// ✅ 이렇게 (StripeBannerManager 스타일)
<div className="overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm">
  {/* 헤더 */}
  <button onClick={() => setIsExpanded(!isExpanded)} className="flex w-full items-center justify-between px-6 py-4">
    <div className="flex items-center gap-3">
      <IconChevronDown size={20} className={isExpanded ? '' : '-rotate-90'} />
      <div>
        <h3 className="text-base font-semibold text-slate-900">히어로배너 관리</h3>
        <p className="mt-0.5 text-sm text-slate-500">공고 목록 왼쪽 패널 상단 배너를 관리합니다.</p>
      </div>
    </div>
    <div className="flex items-center gap-2">
      {config?.isActive && (
        <span className="rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-700">
          활성화
        </span>
      )}
    </div>
  </button>

  {/* 펼쳐진 콘텐츠 */}
  <div className={`transition-all duration-300 ease-in-out ${
    isExpanded ? 'max-h-[3000px] opacity-100' : 'max-h-0 opacity-0'
  }`}>
    {isExpanded && (
      <div className="border-t border-slate-200 p-6">
        {/* 저장 버튼 */}
        <div className="mb-6 flex justify-end">
          <button className="rounded-lg bg-blue-600 px-6 py-2.5 text-sm font-semibold text-white">
            모두 저장
          </button>
        </div>

        {/* 2단 그리드 */}
        <div className="grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(400px,480px)]">
          {/* 좌측: 편집 폼 */}
          <div className="space-y-5">
            <section className="rounded-xl border border-slate-200 bg-slate-50/60 px-5 py-4">
              <h4 className="text-sm font-semibold text-slate-800">기본 설정</h4>
              {/* ... */}
            </section>
          </div>

          {/* 우측: 미리보기 + 관리 */}
          <div className="space-y-5">
            <HeroBannerPreview />
            <section className="rounded-xl border border-slate-200 bg-slate-50/60 px-5 py-4">
              <h4 className="text-sm font-semibold text-slate-800">배너 목록</h4>
              {/* ... */}
            </section>
          </div>
        </div>
      </div>
    )}
  </div>
</div>
```

### 8.2 컬러 피커

```tsx
// ColorInputField 재사용 (StripeBannerManager에서 사용 중)
import ColorInputField from './ColorInputField';

<ColorInputField
  label="배경색"
  value={banner.bgColor}
  onChange={(color) => handleUpdate({ bgColor: color })}
/>
```

---

## 9. 프리셋 컬러

관리자가 빠르게 선택할 수 있도록 프리셋 제공:

| 용도 | 이름 | HEX | 클래스 |
|------|------|-----|--------|
| 기본 | 파랑 | #3B82F6 | `bg-[#3B82F6]` |
| 강조 | 소프트 레드 | #F87171 | `bg-[#F87171]` |
| 이벤트 | 녹색 | #10B981 | `bg-[#10B981]` |
| 공지 | 노랑 | #FBBF24 | `bg-[#FBBF24]` |

---

## 10. 프론트엔드 연동 (HeroCard.tsx)

### 10.1 현재 상태

**파일**: `src/pages/new-landing/components/HeroCard.tsx`

```tsx
// 현재 (라인 43-52) - DB 연동 비활성화 상태
useEffect(() => {
    setBanners([DEFAULT_BANNER]);
    setConfig({
        id: 'dummy',
        rotationSpeed: 5,
        isActive: true,
        createdAt: '',
        updatedAt: ''
    });
    setIsLoading(false);

    /* 기존 DB 로드 로직 주석 처리됨 (라인 54-78) */
}, []);
```

### 10.2 연동 방법

관리자 페이지 구현 완료 후 **HeroCard.tsx** 수정:

```tsx
// 변경 후 - DB 연동 활성화
useEffect(() => {
    const loadBanners = async () => {
        try {
            const [configData, bannersData] = await Promise.all([
                getHeroBannerConfig(),
                getActiveHeroBanners()  // isActive=true인 배너만
            ]);

            setConfig(configData);

            // DB에 배너가 있으면 사용, 없으면 DEFAULT_BANNER
            if (bannersData.length > 0) {
                setBanners(bannersData);
            } else {
                setBanners([DEFAULT_BANNER]);
            }
        } catch (error) {
            console.error('Failed to load hero banners:', error);
            // 에러 발생 시 DEFAULT_BANNER로 fallback
            setBanners([DEFAULT_BANNER]);
        } finally {
            setIsLoading(false);
        }
    };

    loadBanners();
}, []);
```

### 10.3 데이터 흐름

```
관리자 페이지
  ↓
[배너 수정/추가/삭제]
  ↓
Supabase DB (hero_banners, hero_banner_config)
  ↓
HeroCard.tsx (마운트 시 로드)
  ↓
사용자에게 표시
```

### 10.4 실시간 반영 방법

#### 방법 1: 페이지 새로고침 (간단)
- 관리자가 배너 수정 후 메인 페이지 새로고침
- 자동으로 최신 데이터 로드

#### 방법 2: Supabase Realtime (선택적, 고급)
```tsx
// HeroCard.tsx에 추가 (선택사항)
useEffect(() => {
    const subscription = supabase
        .channel('hero_banners_changes')
        .on('postgres_changes',
            { event: '*', schema: 'public', table: 'hero_banners' },
            () => {
                // 변경 감지 시 데이터 재로드
                loadBanners();
            }
        )
        .subscribe();

    return () => {
        subscription.unsubscribe();
    };
}, []);
```

**권장**: 방법 1 (간단하고 충분함)

### 10.5 연동 체크리스트

- [ ] HeroCard.tsx useEffect 주석 해제 및 수정
- [ ] getHeroBannerConfig() 함수 동작 확인
- [ ] getActiveHeroBanners() 함수 동작 확인
- [ ] 배너 0개일 때 DEFAULT_BANNER 표시 확인
- [ ] 배너 1개일 때 회전 안 함 확인
- [ ] 배너 2개 이상일 때 회전 동작 확인
- [ ] config.isActive = false일 때 배너 숨김 확인
- [ ] 에러 발생 시 fallback 동작 확인

### 10.6 테스트 시나리오 (전체 연동)

#### 시나리오 1: 배너 추가
1. 관리자 페이지에서 새 배너 추가
   - 제목: "신규 공고 100건 업데이트!"
   - 배경색: #10B981 (녹색)
   - 활성화: ✓
2. [저장] 클릭
3. 메인 페이지 새로고침
4. **예상 결과**: 새 배너가 회전 목록에 추가됨

#### 시나리오 2: 배너 수정
1. 관리자 페이지에서 기존 배너 수정
   - "설문참여해서 커피쿠폰 받기 →"
   - → "이벤트 참여하고 선물 받기 →"
2. [저장] 클릭
3. 메인 페이지 새로고침
4. **예상 결과**: 수정된 텍스트 표시

#### 시나리오 3: 배너 비활성화
1. 관리자 페이지에서 특정 배너 비활성화
2. [저장] 클릭
3. 메인 페이지 새로고침
4. **예상 결과**: 해당 배너가 회전 목록에서 제외됨

#### 시나리오 4: 전체 시스템 비활성화
1. 관리자 페이지에서 "배너 시스템 활성화" 체크 해제
2. [저장] 클릭
3. 메인 페이지 새로고침
4. **예상 결과**: HeroCard 전체가 표시 안 됨 (또는 DEFAULT_BANNER만 표시)

#### 시나리오 5: 모든 배너 삭제
1. 관리자 페이지에서 모든 배너 삭제
2. 메인 페이지 새로고침
3. **예상 결과**: DEFAULT_BANNER 표시 (fallback)

### 10.7 배포 시 주의사항

1. **DB 초기 데이터**:
   - 현재 DEFAULT_BANNER를 DB에 수동 삽입 필요
   ```sql
   INSERT INTO hero_banners (
     id, title, bg_color, text_color, link_url,
     display_order, is_active
   ) VALUES (
     gen_random_uuid(),
     '설문참여해서 커피쿠폰 받기 →',
     '#3B82F6',
     '#FFFFFF',
     'https://forms.gle/YOUR_ACTUAL_FORM_ID',
     0,
     true
   );
   ```

2. **Config 초기화**:
   ```sql
   INSERT INTO hero_banner_config (
     id, rotation_speed, is_active
   ) VALUES (
     gen_random_uuid(),
     5,
     true
   );
   ```

3. **환경 변수**:
   - `.env` 파일의 `VITE_SURVEY_URL` 업데이트
   - 배포 환경에서도 동일하게 설정

4. **캐싱 고려**:
   - Cloudflare Pages 캐시 무효화
   - 사용자 브라우저 캐시 (Hard Refresh 안내)

---

## 11. 주의사항

1. **레이아웃 조화**:
   - StripeBannerManager와 동일한 구조 유지
   - 헤더, 그리드, 섹션 스타일 일관성

2. **전체 페이지 영향 최소화**:
   - 접을 수 있어야 함 (기본 접힌 상태)
   - 다른 섹션과 같은 높이 제한 (`max-h-[3000px]`)

3. **입력 검증**:
   - 제목 필수
   - 색상 HEX 형식 검증
   - URL 유효성 검증

4. **에러 처리**:
   - DB 연결 실패 시 fallback
   - 토스트 알림
   - 로딩 상태 표시

---

## 12. 테스트 시나리오

### 12.1 섹션 추가
1. 관리자 페이지 → 홍보카드 관리 탭
2. "히어로배너 관리" 섹션 표시 확인
3. 접기/펼치기 동작 확인

### 12.2 배너 생성
1. [+ 새 배너] 클릭
2. 모달에서 제목, 색상, 링크 입력
3. 미리보기 확인
4. [저장] → 목록에 추가 확인
5. 실제 사이트에서 배너 표시 확인

### 12.3 배너 수정
1. 기존 배너 [편집] 클릭
2. 필드 수정
3. 실시간 미리보기 업데이트 확인
4. [저장] → 변경사항 반영 확인

### 12.4 다른 섹션과의 공존
1. 띠지배너 관리 섹션과 동시에 열기
2. 각각 독립적으로 동작하는지 확인
3. 전체 페이지 스크롤 가능 확인

---

**작성자**: Claude
**최종 수정**: 2026-01-26 (v2)
