# PWA 설치 플로우 개선 플랜

> 작성일: 2026-01-27
> 상태: 검토 중

---

## 📋 현재 문제점

### 1. 첫 방문 모달 타이밍
- **현재**: 페이지 로드 즉시 (0초) 모달 표시
- **문제**: 사이트 경험도 못 하고 설치 권유 → 이탈률 증가

### 2. 외부 브라우저 이동 후 설치 버튼
- **현재**: `renderInstallButton` prop 미전달로 **설치 버튼이 아예 렌더링 안 됨**
- **문제**: 카톡 → 외부 브라우저 이동 후 설치 방법 없음

---

## 🎯 개선된 플로우

### 시나리오 A: 카카오톡 인앱 브라우저에서 접속

```
┌─────────────────────────────────────────────────────────┐
│  1. 카톡에서 링크 클릭                                   │
│         ↓                                               │
│  2. 사이트 로딩 → 15초 동안 자유롭게 둘러봄             │
│         ↓                                               │
│  3. 15초 후: "브라우저 이동 안내" 모달                   │
│     ┌───────────────────────────────────┐               │
│     │  📱 더 나은 경험을 위해            │               │
│     │     외부 브라우저에서 열어보세요   │               │
│     │                                   │               │
│     │  • 앱 설치 가능                   │               │
│     │  • 더 빠른 속도                   │               │
│     │                                   │               │
│     │  [Chrome으로 열기 →]              │               │
│     │  [나중에 할게요]                  │               │
│     └───────────────────────────────────┘               │
│         ↓ (Chrome으로 열기 클릭)                        │
│  4. 외부 브라우저(Chrome/Safari)로 이동                 │
│         ↓                                               │
│  5. 이동 직후: "앱 설치" 모달 자동 표시                  │
│     ┌───────────────────────────────────┐               │
│     │  🎉 학교일자리를                   │               │
│     │     앱으로 설치하세요!            │               │
│     │                                   │               │
│     │  📱 홈 화면에서 바로 접속          │               │
│     │  ⚡ 앱처럼 빠르게 실행             │               │
│     │  🔔 새 공고 알림 (준비 중)         │               │
│     │                                   │               │
│     │  [앱으로 설치하기 →]              │               │
│     │  [나중에 할게요]                  │               │
│     └───────────────────────────────────┘               │
└─────────────────────────────────────────────────────────┘
```

### 시나리오 B: 일반 브라우저에서 직접 접속

```
┌─────────────────────────────────────────────────────────┐
│  1. 주소창에 학교일자리.com 입력                         │
│         ↓                                               │
│  2. 사이트 로딩 → 15초 동안 자유롭게 둘러봄             │
│         ↓                                               │
│  3. 15초 후: "앱 설치" 모달 바로 표시                    │
│     ┌───────────────────────────────────┐               │
│     │  🎉 학교일자리를                   │               │
│     │     앱으로 설치하세요!            │               │
│     │                                   │               │
│     │  📱 홈 화면에서 바로 접속          │               │
│     │  ⚡ 앱처럼 빠르게 실행             │               │
│     │  🔔 새 공고 알림 (준비 중)         │               │
│     │                                   │               │
│     │  [앱으로 설치하기 →]              │               │
│     │  [나중에 할게요]                  │               │
│     └───────────────────────────────────┘               │
└─────────────────────────────────────────────────────────┘
```

---

## 📊 플로우 비교표

| 조건 | 15초 후 모달 | 모달 내용 |
|------|-------------|----------|
| 카톡 인앱 + 첫 방문 | ✅ | "외부 브라우저로 이동" 안내 |
| 카톡 → 외부 이동 직후 | ✅ | "앱 설치" 모달 |
| 일반 브라우저 + 첫 방문 | ✅ | "앱 설치" 모달 |
| PWA 이미 설치됨 | ❌ | - |
| 데스크톱 PC | ❌ | - |
| 재방문 (localStorage 기록) | ❌ | - |

---

## 🔧 구현 변경사항

### 1. usePWAInstall.ts 수정

**Before:**
```typescript
useEffect(() => {
    if (isPWAInstalled()) return;
    if (!isMobile()) return;

    if (isKakaoTalk() && isTrueFirstVisit()) {
        setShowFirstVisitModal(true);  // 즉시 표시
    }
}, []);
```

**After:**
```typescript
useEffect(() => {
    if (isPWAInstalled()) return;
    if (!isMobile()) return;

    if (isTrueFirstVisit()) {
        const timer = setTimeout(() => {
            if (isKakaoTalk()) {
                // 카톡: 브라우저 이동 안내 모달
                setShowBrowserRedirectModal(true);
            } else {
                // 일반 브라우저: 설치 모달
                setShowInstallModal(true);
            }
        }, 15000);  // 15초 딜레이

        return () => clearTimeout(timer);
    }
}, []);
```

### 2. 외부 브라우저 이동 감지

**방법**: URL 파라미터 또는 sessionStorage 활용

```typescript
// 카톡에서 외부 브라우저로 이동 시 URL에 파라미터 추가
const targetUrl = `${getCurrentURL()}?from=kakao`;

// 외부 브라우저에서 감지
useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    if (params.get('from') === 'kakao' && !isKakaoTalk()) {
        // 카톡에서 넘어온 경우 → 설치 모달 즉시 표시
        setShowInstallModal(true);

        // 파라미터 제거 (URL 정리)
        params.delete('from');
        const cleanUrl = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
        window.history.replaceState({}, '', cleanUrl);
    }
}, []);
```

### 3. 새로운 모달 컴포넌트 필요

| 모달 | 용도 | 버튼 |
|------|------|------|
| `BrowserRedirectModal` | 카톡 → 외부 브라우저 이동 안내 | [Chrome으로 열기] [나중에] |
| `InstallPromptModal` | PWA 설치 권유 | [설치하기] [나중에] |

※ 기존 `FirstVisitInstallPrompt`를 분리하거나 역할 재정의 필요

---

## 📁 영향받는 파일

```
src/
├── hooks/
│   └── usePWAInstall.ts          # 로직 수정 (15초 딜레이, 분기 처리)
├── components/pwa/
│   ├── BrowserRedirectModal.tsx  # 신규 (카톡 이동 안내)
│   ├── InstallPromptModal.tsx    # 신규 또는 기존 수정
│   └── PWAProvider.tsx           # 모달 연결
└── lib/utils/
    └── pwaUtils.ts               # from=kakao 파라미터 처리
```

---

## ⏱️ 타이밍 상수

```typescript
const PWA_PROMPT_DELAY = 15000;  // 15초 (밀리초)
```

**15초 선택 이유:**
- 너무 짧으면 (5초): 아직 사이트 파악 못 함
- 너무 길면 (30초+): 이미 이탈했을 수 있음
- 15초: 대략 2-3개 공고 카드 확인 가능한 시간

---

## ✅ 체크리스트

- [ ] usePWAInstall.ts에 15초 딜레이 추가
- [ ] 카톡/일반 브라우저 분기 처리
- [ ] BrowserRedirectModal 컴포넌트 생성
- [ ] InstallPromptModal 컴포넌트 생성 (또는 기존 수정)
- [ ] from=kakao 파라미터 감지 로직
- [ ] PWAProvider에 새 모달 연결
- [ ] 테스트: 카톡 인앱 → 외부 이동 → 설치
- [ ] 테스트: 일반 브라우저 직접 접속 → 설치
- [ ] 테스트: ?reset-pwa=true로 초기화 후 재테스트

---

*작성: Claude Code*
