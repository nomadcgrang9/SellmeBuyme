# 등록 위치 선택 개선 플랜 (v2)

## 배경 및 문제점

### 현재 상황
1. 등록 버튼 클릭 → 지도에서 위치 찍기 → 모달창
2. **문제**: 사용자들이 "자기 집"을 찍음
3. 마커로 정확한 위치가 표시되어 프라이버시 우려

### 근본적 해결
**지도 찍기 과정 자체를 제거**하고, 행정구역(구/읍/면) 선택 방식으로 전환

---

## 변경 개요

### Before (현재)
```
등록 버튼 → 지도에서 위치 찍기 → 모달창 → 등록
```

### After (변경)
```
등록 버튼 → 바로 모달창 → 구/읍/면 선택 → 등록 → 마커 위치로 지도 이동
```

---

## 적용 대상

| 등록 유형 | 적용 여부 | 이유 |
|----------|----------|------|
| **구직등록** | O | 프라이버시 보호 필요 |
| **강사등록** | O | 프라이버시 보호 필요 |
| **공고등록** | X | 학교/기관 위치는 정확해야 함 |

---

## UI 변경 상세

### 1. 위치 필드 UI

```
┌─────────────────────────────────────────────────────┐
│  ● 구직 등록                                    ✕   │
├─────────────────────────────────────────────────────┤
│                                                     │
│  위치 *                                             │
│  ┌─────────────────────────────────────────────┐   │
│  │ 거주하시는 지역의 구, 읍, 면 정도만          │   │
│  │ 지정해주세요.                                │   │
│  │ 등록마커는 해당 지역 내 임의 장소에          │   │
│  │ 배정됩니다.                                  │   │
│  ├─────────────────────────────────────────────┤   │
│  │  ◎  용인시 기흥구                    [변경] │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  기본 정보                                          │
│  ...                                                │
└─────────────────────────────────────────────────────┘
```

### 2. "변경" 버튼 클릭 시 (같은 모달 내)

```
┌─────────────────────────────────────────────────────┐
│  위치 *                                             │
│  ┌─────────────────────────────────────────────┐   │
│  │ 거주하시는 지역의 구, 읍, 면 정도만          │   │
│  │ 지정해주세요.                                │   │
│  ├─────────────────────────────────────────────┤   │
│  │  🔍 [성남시 분당                        ]   │   │
│  │  ────────────────────────────────────────   │   │
│  │  성남시 분당구                               │   │
│  │  성남시 수정구                               │   │
│  │  성남시 중원구                               │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

### 3. 검색 UI 특징

- **자동완성 검색**: "기흥" 입력 → "용인시 기흥구" 표시
- **전국 데이터**: 모든 구/읍/면 검색 가능
- **표시 형식**: "시/군 + 구/읍/면" (예: 용인시 기흥구, 청주시 상당구)

---

## 데이터 처리

### 저장 데이터

```typescript
interface LocationData {
  // 행정구역 정보
  regionCode: string;      // 행정구역 코드 (예: "4146300000")
  regionName: string;      // 표시명 (예: "용인시 기흥구")

  // 랜덤 생성 좌표 (최초 등록 시 생성, 고정)
  latitude: number;        // 위도
  longitude: number;       // 경도
}
```

### 랜덤 좌표 생성 로직

```typescript
function generateRandomCoordinate(regionCode: string): { lat: number; lng: number } {
  // 1. 행정구역 경계(bounding box) 조회
  const bounds = getRegionBounds(regionCode);

  // 2. 경계 내 랜덤 좌표 생성
  const lat = randomBetween(bounds.minLat, bounds.maxLat);
  const lng = randomBetween(bounds.minLng, bounds.maxLng);

  // 3. 실제 행정구역 내 포함 여부 확인 (폴리곤 체크)
  // 포함 안 되면 재생성

  return { lat, lng };
}
```

### 등록 완료 후 동작

1. 등록 데이터 저장 (랜덤 좌표 포함)
2. 모달 닫힘
3. **지도가 해당 마커 위치로 자동 이동**
4. 마커 팝업 표시 (선택적)

---

## 행정구역 데이터

### 데이터 소스 옵션

| 옵션 | 장점 | 단점 |
|------|------|------|
| **카카오맵 API** | 실시간, 정확 | API 호출 비용 |
| **행정안전부 데이터** | 무료, 공식 | 주기적 업데이트 필요 |
| **자체 DB** | 빠름, 커스터마이징 | 초기 구축 필요 |

### 추천: 카카오맵 API + 캐싱

```typescript
// 검색 시 카카오맵 API 활용
const searchRegion = async (query: string) => {
  // 캐시 확인
  const cached = regionCache.get(query);
  if (cached) return cached;

  // 카카오맵 API 호출
  const results = await kakaoMap.searchAddress(query);

  // 구/읍/면 단위만 필터링
  const filtered = results.filter(r =>
    r.address_type === 'REGION' &&
    ['구', '읍', '면'].some(suffix => r.region_3depth_name?.endsWith(suffix))
  );

  // 캐싱
  regionCache.set(query, filtered);

  return filtered;
};
```

---

## 구현 순서

### Phase 1: 데이터 구조 변경
1. `talents` 테이블에 `region_code`, `region_name` 컬럼 추가 (기존 좌표 컬럼 유지)
2. 기존 테스트 데이터 삭제 (사용자 직접 처리)

### Phase 2: 지역 검색 컴포넌트
1. `RegionSearchInput.tsx` 컴포넌트 생성
2. 카카오맵 API 연동 (주소 검색)
3. 자동완성 UI 구현
4. 디바운싱 적용 (300ms)

### Phase 3: 등록 모달 수정
1. 지도 찍기 단계 제거
2. 등록 버튼 → 바로 모달 열림
3. 위치 필드에 안내 문구 + 지역 선택 UI
4. "변경" 버튼 → 검색 UI 토글

### Phase 4: 랜덤 좌표 생성
1. `generateRandomCoordinate()` 유틸 함수
2. 행정구역 경계 데이터 활용
3. 등록 시 좌표 생성 및 저장

### Phase 5: 등록 완료 후 지도 이동
1. 등록 성공 콜백에서 지도 이동 처리
2. 해당 마커 하이라이트/팝업

### Phase 6: 테스트
1. 다양한 지역 검색 테스트
2. 모바일/데스크톱 반응형 확인
3. 랜덤 좌표가 실제 행정구역 내인지 확인

---

## 영향 받는 컴포넌트

```
src/
├── components/
│   ├── registration/
│   │   ├── TalentRegistrationModal.tsx  (수정)
│   │   ├── InstructorRegistrationModal.tsx  (수정)
│   │   ├── RegionSearchInput.tsx  (신규)
│   │   └── LocationPicker.tsx  (삭제 또는 공고등록 전용으로 유지)
│   └── map/
│       └── (마커 클릭 시 이동 로직)
├── lib/
│   ├── utils/
│   │   └── regionUtils.ts  (신규 - 랜덤 좌표 생성)
│   └── api/
│       └── kakaoMap.ts  (수정 - 지역 검색 추가)
└── pages/
    └── new-landing/components/Hero.tsx  (등록 플로우 수정)
```

---

## UI 문구 정리

### 위치 필드 안내문
```
거주하시는 지역의 구, 읍, 면 정도만 지정해주세요.
등록마커는 해당 지역 내 임의 장소에 배정됩니다.
```

### 검색 플레이스홀더
```
지역명 검색 (예: 분당구, 기흥구)
```

### 초기 표시값 (위치 미선택 시)
```
지역을 선택해주세요
```

---

## 기존 데이터 처리

- **기존 구직자/강사 데이터**: 테스트 데이터이므로 사용자가 직접 삭제
- **마이그레이션 불필요**
- 신규 등록부터 새 방식 적용

---

## 모바일 대응

- 데스크톱과 동일한 플로우
- 검색 UI는 모달 내 인라인 (바텀시트 X)
- 터치 친화적 검색 결과 리스트 (최소 44px 높이)

---

## 예상 리스크

| 리스크 | 대응 |
|--------|------|
| 카카오맵 API 호출 제한 | 검색 결과 캐싱, 디바운싱 적용 |
| 행정구역 경계 밖 좌표 생성 | 폴리곤 체크 후 재생성 |
| 검색 결과 없음 | "검색 결과가 없습니다" 안내 |

---

**작성일**: 2026-01-30
**버전**: 2.0
**프로젝트**: SellmeBuyme (학교일자리)
