# 260127 ê´€ë¦¬ìí˜ì´ì§€ ê°œì„ í”Œëœ

> ì‘ì„±ì¼: 2026-01-27
> ëª©í‘œ: ê´€ë¦¬ì í˜ì´ì§€ í†µí•© ë° ëŒ€ì‹œë³´ë“œ ì‚¬ìš©ëŸ‰ í†µê³„ ì •ìƒí™”

---

## 1. í˜„í™© ì§„ë‹¨

### 1.1 ê´€ë¦¬ì í˜ì´ì§€ ì´ì›í™” ë¬¸ì œ

í˜„ì¬ **ë‘ ê°œì˜ ê´€ë¦¬ì í˜ì´ì§€**ê°€ ì¡´ì¬í•˜ë©°, **ì½”ë“œ ì¤‘ë³µë¥ ì´ ì•½ 95%**ì— ë‹¬í•¨.

| êµ¬ë¶„ | AdminPage.tsx | TeamConsolePage.tsx |
|------|---------------|---------------------|
| **ê²½ë¡œ (DEV)** | `/admin` | `/team-console` |
| **ê²½ë¡œ (PROD)** | `/admin-portal` | í™˜ê²½ë³€ìˆ˜ `VITE_TEAM_CONSOLE_PATH` |
| **ì¸ì¦ ë°©ì‹** | Supabase Auth + `isAdmin` ë¡¤ ì²´í¬ | ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (í™˜ê²½ë³€ìˆ˜) |
| **ëŒ€ì‹œë³´ë“œ** | âœ… í™œì„±í™” | âœ… í™œì„±í™” (ë™ì¼ ì»´í¬ë„ŒíŠ¸) |
| **í¬ë¡¤ë§ ê´€ë¦¬** | âœ… í™œì„±í™” (NEW ë±ƒì§€) | âš ï¸ ì½”ë“œ ì¡´ì¬, UI íƒ­ë§Œ ì£¼ì„ |
| **í™ë³´ì¹´ë“œ ê´€ë¦¬** | âš ï¸ ì½”ë“œ ì¡´ì¬, UI íƒ­ë§Œ ì£¼ì„ | âœ… í™œì„±í™” |
| **ë°°ë„ˆ ê´€ë¦¬** | âœ… í™œì„±í™” (ì¤€ë¹„ì¤‘) | âŒ ì½”ë“œ ì—†ìŒ |
| **ì‚¬ìš©ì ê´€ë¦¬** | âœ… í™œì„±í™” | âœ… í™œì„±í™” |

**í•µì‹¬ ë°œê²¬:**
- **renderTabContentì˜ case êµ¬í˜„ì€ ì–‘ìª½ì— ê±°ì˜ ë™ì¼í•˜ê²Œ ì¡´ì¬**
- ADMIN_TABS ë°°ì—´ì˜ ì£¼ì„ ì²˜ë¦¬ë§Œìœ¼ë¡œ UI í‘œì‹œ ì—¬ë¶€ ê²°ì •
- ì˜ˆ: TeamConsolePageì˜ 'crawl' caseëŠ” êµ¬í˜„ë˜ì–´ ìˆìœ¼ë‚˜, ADMIN_TABSì—ì„œ ì£¼ì„ì²˜ë¦¬ë¨

**ë¬¸ì œì :**
- ë™ì¼í•œ ê¸°ëŠ¥ ì½”ë“œê°€ **ì–‘ìª½ì— ëª¨ë‘ ì¤‘ë³µ êµ¬í˜„**ë˜ì–´ ìˆìŒ
- AdminPageëŠ” Supabase Auth ì˜ì¡´ â†’ íŠ¹ì • ê³„ì •ì— `admin` ë¡¤ í•„ìš”
- TeamConsolePageëŠ” ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ â†’ ë” ê°„ë‹¨í•˜ì§€ë§Œ ì¼ë¶€ íƒ­ë§Œ í™œì„±í™”
- **ì½”ë“œ ì¤‘ë³µë¥  95%**, ìœ ì§€ë³´ìˆ˜ ì‹œ ì–‘ìª½ ëª¨ë‘ ìˆ˜ì • í•„ìš”

---

### 1.2 ë¼ìš°íŒ… êµ¬ì¡° (`main.tsx`)

```typescript
// ê°œë°œ í™˜ê²½
if (import.meta.env.DEV && pathname.startsWith('/admin')) â†’ AdminPage
if (import.meta.env.DEV && pathname.startsWith('/team-console')) â†’ TeamConsolePage

// í”„ë¡œë•ì…˜ í™˜ê²½
if (import.meta.env.PROD && pathname.startsWith('/admin-portal')) â†’ AdminPage
if (pathname === import.meta.env.VITE_TEAM_CONSOLE_PATH) â†’ TeamConsolePage
```

---

### 1.3 ê¶Œí•œ ì²´ê³„ ë¶„ì„

#### AdminPage ê¶Œí•œ (`useAdminAuth.ts`)
```typescript
// user_profiles í…Œì´ë¸”ì˜ roles ë°°ì—´ì—ì„œ 'admin' í™•ì¸
const hasAdminRole = profile?.roles?.includes('admin') || false;
```

#### TeamConsolePage ê¶Œí•œ
```typescript
// í™˜ê²½ë³€ìˆ˜ ë¹„ë°€ë²ˆí˜¸ ë¹„êµ
const TEAM_PASSWORD = import.meta.env.VITE_TEAM_CONSOLE_PASSWORD;
if (passwordInput === TEAM_PASSWORD) {
  localStorage.setItem('sellba_team_verified', 'verified');
  setIsVerified(true);
}
```

**ê¶Œí•œ ê´€ë ¨ ë¬¸ì œ:**
- AdminPage: íŠ¹ì • ê³„ì •ì— ì§ì ‘ DBì—ì„œ `admin` ë¡¤ ë¶€ì—¬ í•„ìš”
- TeamConsolePage: ë¹„ë°€ë²ˆí˜¸ë§Œ ì•Œë©´ ëˆ„êµ¬ë‚˜ ì ‘ì† ê°€ëŠ¥í•˜ì§€ë§Œ, ê¸°ëŠ¥ì´ ì¶•ì†Œë˜ì–´ ìˆìŒ
- ë‘ ì‹œìŠ¤í…œì´ ë¶„ë¦¬ë˜ì–´ ìˆì–´ ê´€ë¦¬ê°€ ë³µì¡í•¨

---

### 1.4 ëŒ€ì‹œë³´ë“œ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ë°ì´í„° ìˆ˜ì§‘ ë‹¨ê³„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  useActivityTracking.ts                                          â”‚
â”‚    â”œâ”€ getSessionId() â†’ sessionStorage                            â”‚
â”‚    â”œâ”€ getDeviceType() â†’ window.innerWidth                        â”‚
â”‚    â””â”€ getRegionInfo() â†’ localStorage.getItem('user_location')   â”‚
â”‚                          â¬†ï¸ ì´ ê°’ì„ ì €ì¥í•˜ëŠ” ë¡œì§ì´ ì—†ìŒ!          â”‚
â”‚                                                                   â”‚
â”‚  trackActivity() â†’ INSERT INTO user_activity_logs               â”‚
â”‚    metadata: {                                                   â”‚
â”‚      session_id: âœ… ì‘ë™                                         â”‚
â”‚      device_type: âœ… ì‘ë™                                        â”‚
â”‚      region_city: âŒ undefined (ì €ì¥ ë¡œì§ ì—†ìŒ)                   â”‚
â”‚      region_district: âŒ undefined                               â”‚
â”‚    }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Edge Function ì²˜ë¦¬ ë‹¨ê³„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  supabase/functions/dashboard-analytics/index.ts                 â”‚
â”‚                                                                   â”‚
â”‚  // ì§€ì—­ë³„ ë¶„í¬ ê³„ì‚°                                              â”‚
â”‚  allLogs.forEach(log => {                                        â”‚
â”‚    const city = metadata?.region_city || 'ê¸°íƒ€';  // í•­ìƒ 'ê¸°íƒ€'   â”‚
â”‚    regionMap.set(city, ...);                                     â”‚
â”‚  });                                                              â”‚
â”‚                                                                   â”‚
â”‚  // ë°˜í™˜ í˜•ì‹                                                     â”‚
â”‚  regionDistribution: [                                           â”‚
â”‚    { region: 'ê¸°íƒ€', visitors: N, percentage: 100 }              â”‚
â”‚  ]                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ ë‹¨ê³„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  queries.ts: fetchDashboardAnalytics()                           â”‚
â”‚    regionDistribution: data.regionDistribution.map(r => ({       â”‚
â”‚      rank: index + 1,                                            â”‚
â”‚      label: r.region,     // Edge Functionì˜ 'region' â†’ 'label'  â”‚
â”‚      value: r.visitors,   // Edge Functionì˜ 'visitors' â†’ 'value'â”‚
â”‚    }))                                                           â”‚
â”‚                                                                   â”‚
â”‚  RegionStats.tsx                                                 â”‚
â”‚    // 17ê°œ ì‹œë„ ëª©ë¡ê³¼ ë§¤ì¹­                                        â”‚
â”‚    const found = data.find(d => d.label === region);             â”‚
â”‚    // 'ê¸°íƒ€'ëŠ” 17ê°œ ì‹œë„ì— ì—†ìœ¼ë¯€ë¡œ 0ìœ¼ë¡œ í‘œì‹œë¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ ë¬¸ì œ:**
1. `localStorage.getItem('user_location')`ì„ ì €ì¥í•˜ëŠ” ë¡œì§ì´ ì—†ìŒ
2. ë”°ë¼ì„œ `region_city`ê°€ í•­ìƒ `undefined` â†’ Edge Functionì—ì„œ `'ê¸°íƒ€'`ë¡œ ì²˜ë¦¬
3. RegionStatsëŠ” 17ê°œ ì‹œë„ë§Œ í‘œì‹œí•˜ë¯€ë¡œ `'ê¸°íƒ€'`ëŠ” í‘œì‹œë˜ì§€ ì•ŠìŒ

---

### 1.5 GitHub Actions ì›Œí¬í”Œë¡œìš° í˜„í™©

#### í¬ë¡¤ëŸ¬ ê´€ë ¨ (run-crawler.yml)
- 35ê°œ ì†ŒìŠ¤ ì§€ì› (ê´‘ì—­ì‹œë„ 17ê°œ + ê²½ê¸°ë„ ì‹œêµ° 18ê°œ)
- ìŠ¤ì¼€ì¤„: UTC 1AM (í•œêµ­ 10AM), UTC 9AM (í•œêµ­ 6PM)

#### Edge Function ë°°í¬ ì›Œí¬í”Œë¡œìš° (Alt ë°œê²¬)

| ì›Œí¬í”Œë¡œìš° | ë°°í¬ ê°€ëŠ¥ í•¨ìˆ˜ | ë¹„ê³  |
|-----------|---------------|------|
| `deploy-edge.yml` (ì›ë³¸) | `generate-crawler`, `admin-crawl-run` | - |
| `deploy-supabase-edge.yml` **(Alt)** | `generate-crawler`, `admin-crawl-run`, **`dashboard-analytics`** | ëŒ€ì‹œë³´ë“œ í•¨ìˆ˜ ë°°í¬ìš© |

**Alt ì›Œí¬í”Œë¡œìš° íŠ¹ì§•:**
- `dashboard-analytics` Edge Function ë°°í¬ ì˜µì…˜ ì¶”ê°€ë¨
- í™˜ê²½ë³€ìˆ˜ ëˆ„ë½ ì²´í¬ ë¡œì§ í¬í•¨
- ìµœê·¼ ì‹¤í–‰: 2026-01-24 (ì´ 8íšŒ ì‹¤í–‰)
- íŒ€ì›(kimwoody)ì´ ëŒ€ì‹œë³´ë“œ Edge Function ë°°í¬ë¥¼ ìœ„í•´ ì¶”ê°€í•œ ê²ƒìœ¼ë¡œ ì¶”ì •

---

## 2. ê°œì„  ê³„íš

### 2.1 ê´€ë¦¬ì í˜ì´ì§€ í†µí•© (Phase 1)

**ëª©í‘œ:** TeamConsolePage ì¤‘ì‹¬ìœ¼ë¡œ ë‹¨ì¼ ê´€ë¦¬ì í˜ì´ì§€ êµ¬ì¶•

#### 2.1.1 í†µí•© í›„ êµ¬ì¡°

```
TeamConsolePage (í†µí•©)
â”œâ”€â”€ ì¸ì¦: ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ê¸°ì¡´ ìœ ì§€)
â”œâ”€â”€ ëŒ€ì‹œë³´ë“œ (DashboardOverview)
â”œâ”€â”€ í¬ë¡¤ë§ ê²Œì‹œíŒ ê´€ë¦¬ (AdminPageì—ì„œ ì´ë™)
â”œâ”€â”€ í™ë³´ì¹´ë“œ ê´€ë¦¬ (ê¸°ì¡´ ìœ ì§€)
â”œâ”€â”€ ë°°ë„ˆ ê´€ë¦¬ (AdminPageì—ì„œ ì´ë™)
â”œâ”€â”€ ì‚¬ìš©ì ê´€ë¦¬ (ê¸°ì¡´ ìœ ì§€)
â”œâ”€â”€ ì½˜í…ì¸  ê´€ë¦¬
â””â”€â”€ ì„¤ì •
```

#### 2.1.2 ì‘ì—… í•­ëª©

| # | ì‘ì—… | íŒŒì¼ | ë¹„ê³  |
|---|------|------|------|
| 1 | TeamConsolePage í¬ë¡¤ë§ íƒ­ í™œì„±í™” | `TeamConsolePage.tsx` | ADMIN_TABS Line 37 ì£¼ì„ í•´ì œë§Œ í•˜ë©´ ë¨ |
| 2 | TeamConsolePage ë°°ë„ˆ ê´€ë¦¬ ì¶”ê°€ | `TeamConsolePage.tsx` | AdminPage case 'banner' ì½”ë“œ ë³µì‚¬ |
| 3 | main.tsxì—ì„œ AdminPage ë¼ìš°íŒ… ì œê±° | `main.tsx` | `/admin`, `/admin-portal` ì œê±° |
| 4 | AdminPage.tsx íŒŒì¼ ì‚­ì œ ë˜ëŠ” deprecated ì²˜ë¦¬ | `AdminPage.tsx` | ë°±ì—… í›„ ì‚­ì œ |
| 5 | useAdminAuth í›… ì •ë¦¬ | `useAdminAuth.ts` | ë¯¸ì‚¬ìš© ì‹œ ì‚­ì œ |

#### 2.1.3 ì ‘ê·¼ ê²½ë¡œ ë‹¨ì¼í™”

```typescript
// main.tsx ìˆ˜ì • í›„
if (import.meta.env.DEV && pathname.startsWith('/team-console')) â†’ TeamConsolePage
if (import.meta.env.VITE_TEAM_CONSOLE_PATH && pathname === import.meta.env.VITE_TEAM_CONSOLE_PATH) â†’ TeamConsolePage
```

í”„ë¡œë•ì…˜ ê²½ë¡œ: í™˜ê²½ë³€ìˆ˜ `VITE_TEAM_CONSOLE_PATH`ë¡œ ì„¤ì • (ë³´ì•ˆìƒ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ê²½ë¡œ ê¶Œì¥)

---

### 2.2 ê¶Œí•œ ì²´ê³„ ê°„ì†Œí™” (Phase 1)

**ëª©í‘œ:** ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í†µê³¼ ì‹œ ëª¨ë“  ê¸°ëŠ¥ ì—´ëŒ/ìˆ˜ì • ê°€ëŠ¥

#### í˜„ì¬ â†’ ê°œì„  í›„

| í˜„ì¬ | ê°œì„  í›„ |
|------|---------|
| AdminPage: Supabase Auth + admin ë¡¤ | ì‚­ì œ |
| TeamConsolePage: ë¹„ë°€ë²ˆí˜¸ë§Œ | ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í›„ ëª¨ë“  íƒ­ ì ‘ê·¼ ê°€ëŠ¥ |
| ì¼ë¶€ íƒ­ ì£¼ì„ì²˜ë¦¬ë¨ | ëª¨ë“  íƒ­ í™œì„±í™” |

#### ì‘ì—… í•­ëª©

1. TeamConsolePageì˜ `ADMIN_TABS` Line 37 ì£¼ì„ í•´ì œ (í¬ë¡¤ë§)
2. `ADMIN_TABS`ì— ë°°ë„ˆ ê´€ë¦¬ í•­ëª© ì¶”ê°€
3. renderTabContentì— case 'banner' ì¶”ê°€ (AdminPageì—ì„œ ë³µì‚¬)

---

### 2.3 ëŒ€ì‹œë³´ë“œ ì§€ì—­ í†µê³„ ìˆ˜ì • (Phase 2)

**ëª©í‘œ:** ì§€ì—­ë³„ ì ‘ì† í˜„í™© ì •ìƒ ì‘ë™

#### 2.3.1 ë°©ì•ˆ A: ì‚¬ìš©ì ê´€ì‹¬ì§€ì—­ í™œìš© (ê¶Œì¥)

ì‚¬ìš©ìê°€ í”„ë¡œí•„ì—ì„œ ì„¤ì •í•œ `interest_regions`ë¥¼ í™œìš©

```typescript
// useActivityTracking.ts ìˆ˜ì •
const getRegionInfo = async (): Promise<{ city?: string }> => {
  // 1. ë¡œê·¸ì¸ ì‚¬ìš©ì: í”„ë¡œí•„ì˜ interest_regions ì²« ë²ˆì§¸ ê°’ ì‚¬ìš©
  const { data: { user } } = await supabase.auth.getUser();
  if (user) {
    const { data: profile } = await supabase
      .from('user_profiles')
      .select('interest_regions, primary_region')
      .eq('user_id', user.id)
      .single();

    if (profile?.primary_region) {
      return { city: extractCity(profile.primary_region) };
    }
    if (profile?.interest_regions?.[0]) {
      return { city: extractCity(profile.interest_regions[0]) };
    }
  }

  // 2. ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì: ê²€ìƒ‰ í•„í„°ì—ì„œ ì‚¬ìš©í•œ ì§€ì—­ ì €ì¥
  const cached = localStorage.getItem('last_search_region');
  if (cached) return { city: cached };

  return { city: 'ë¯¸ë¶„ë¥˜' };
};
```

**ì¥ì :** ë³„ë„ API í˜¸ì¶œ ë¶ˆí•„ìš”, ê°œì¸ì •ë³´ ì´ìŠˆ ì—†ìŒ

#### 2.3.2 ë°©ì•ˆ B: IP Geolocation API í™œìš©

ì™¸ë¶€ APIë¥¼ í†µí•´ IP ê¸°ë°˜ ì§€ì—­ ì¶”ì •

```typescript
// ì™¸ë¶€ API ì˜ˆì‹œ (ip-api.com, ipinfo.io ë“±)
const response = await fetch('https://ipapi.co/json/');
const { city, region } = await response.json();
localStorage.setItem('user_location', JSON.stringify({ city: region }));
```

**ë‹¨ì :** ì™¸ë¶€ API ì˜ì¡´, ë¹„ìš© ë°œìƒ ê°€ëŠ¥, VPN ì‚¬ìš© ì‹œ ë¶€ì •í™•

#### 2.3.3 ë°©ì•ˆ C: ê²€ìƒ‰/í•„í„° ì§€ì—­ ê¸°ë°˜

ì‚¬ìš©ìê°€ ê²€ìƒ‰í•˜ê±°ë‚˜ í•„í„°ë§í•œ ì§€ì—­ì„ ê¸°ë¡

```typescript
// Hero.tsx ë˜ëŠ” searchStore.tsì—ì„œ
const handleRegionFilter = (region: string) => {
  localStorage.setItem('last_search_region', extractCity(region));
  // ê¸°ì¡´ í•„í„° ë¡œì§...
};
```

---

### 2.4 RegionStats ë°ì´í„° í˜¸í™˜ì„± ìˆ˜ì • (Phase 2)

í˜„ì¬ `RegionStats.tsx`ê°€ 17ê°œ ì‹œë„ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë¼ë²¨ë§Œ í‘œì‹œí•¨.

#### ìˆ˜ì • í•„ìš”ì‚¬í•­

```typescript
// RegionStats.tsx ìˆ˜ì •
// 'ê¸°íƒ€' ë˜ëŠ” 'ë¯¸ë¶„ë¥˜' ë°ì´í„°ë„ í‘œì‹œë˜ë„ë¡ ê°œì„ 
const ALL_REGIONS = [
  'ì„œìš¸', 'ë¶€ì‚°', 'ëŒ€êµ¬', 'ì¸ì²œ', 'ê´‘ì£¼', 'ëŒ€ì „', 'ìš¸ì‚°', 'ì„¸ì¢…',
  'ê²½ê¸°', 'ê°•ì›', 'ì¶©ë¶', 'ì¶©ë‚¨', 'ì „ë¶', 'ì „ë‚¨', 'ê²½ë¶', 'ê²½ë‚¨', 'ì œì£¼',
  'ê¸°íƒ€', 'ë¯¸ë¶„ë¥˜'  // ì¶”ê°€
];
```

---

## 3. ì‘ì—… ìš°ì„ ìˆœìœ„

### Phase 1: ê´€ë¦¬ì í˜ì´ì§€ í†µí•© (1-2ì¼)

1. [ ] TeamConsolePageì— í¬ë¡¤ë§ ê´€ë¦¬ íƒ­ ì¶”ê°€ (ì£¼ì„ í•´ì œ)
2. [ ] TeamConsolePageì— ë°°ë„ˆ ê´€ë¦¬ íƒ­ ì¶”ê°€
3. [ ] main.tsxì—ì„œ AdminPage ë¼ìš°íŒ… ì •ë¦¬
4. [ ] AdminPage.tsx deprecated ì²˜ë¦¬
5. [ ] í…ŒìŠ¤íŠ¸: ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í›„ ëª¨ë“  íƒ­ ì ‘ê·¼ í™•ì¸

### Phase 2: ëŒ€ì‹œë³´ë“œ í†µê³„ ìˆ˜ì • (2-3ì¼)

1. [ ] ì§€ì—­ ì •ë³´ ìˆ˜ì§‘ ë°©ì‹ ê²°ì • (A/B/C ì¤‘ ì„ íƒ)
2. [ ] useActivityTracking.ts ìˆ˜ì •
3. [ ] RegionStats.tsx í˜¸í™˜ì„± ê°œì„ 
4. [ ] Edge Function ë¡œê¹… ì¶”ê°€ (ë””ë²„ê¹…ìš©)
5. [ ] í…ŒìŠ¤íŠ¸: ì‹¤ì œ ì ‘ì† í›„ ì§€ì—­ í†µê³„ í™•ì¸

### Phase 3: ì¶”ê°€ ê°œì„  (ì„ íƒ)

1. [ ] ëŒ€ì‹œë³´ë“œì— í¬ë¡¤ëŸ¬ ìƒíƒœ ìœ„ì ¯ ì¶”ê°€
2. [ ] ì‹¤ì‹œê°„ ì ‘ì†ì ìˆ˜ í‘œì‹œ
3. [ ] ì¸ê¸° ê²€ìƒ‰ì–´ ì°¨íŠ¸ ì¶”ê°€ (search_logs í™œìš©)

---

## 4. í™˜ê²½ë³€ìˆ˜ ì •ë¦¬

### í˜„ì¬ ì‚¬ìš© ì¤‘

| ë³€ìˆ˜ëª… | ìš©ë„ | ìœ„ì¹˜ |
|--------|------|------|
| `VITE_TEAM_CONSOLE_PASSWORD` | íŒ€ ì½˜ì†” ë¹„ë°€ë²ˆí˜¸ | Cloudflare Pages |
| `VITE_TEAM_CONSOLE_PATH` | íŒ€ ì½˜ì†” ì ‘ê·¼ ê²½ë¡œ | Cloudflare Pages |
| `VITE_SUPABASE_URL` | Supabase URL | `.env.local` |
| `VITE_SUPABASE_ANON_KEY` | Supabase Anon Key | `.env.local` |

### í†µí•© í›„ í•„ìš” ë³€ìˆ˜

- `VITE_TEAM_CONSOLE_PASSWORD`: ìœ ì§€
- `VITE_TEAM_CONSOLE_PATH`: ìœ ì§€ (ë³´ì•ˆ ê²½ë¡œ)
- AdminPage ê´€ë ¨ ë³€ìˆ˜: ë¶ˆí•„ìš” (ì‚­ì œ ê°€ëŠ¥)

---

## 5. ë¦¬ìŠ¤í¬ ë° ê³ ë ¤ì‚¬í•­

### 5.1 AdminPage ì‚­ì œ ì‹œ ì˜í–¥

- `useAdminAuth` í›…ì„ ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ í™•ì¸ í•„ìš”
- RLS ì •ì±…ì—ì„œ `admin` ë¡¤ì„ ì°¸ì¡°í•˜ëŠ” ê²½ìš° í™•ì¸ í•„ìš”

### 5.2 ì§€ì—­ í†µê³„ ì •í™•ë„

- ë°©ì•ˆ A (ê´€ì‹¬ì§€ì—­): í”„ë¡œí•„ ë¯¸ì„¤ì • ì‚¬ìš©ìëŠ” `ë¯¸ë¶„ë¥˜`ë¡œ ì²˜ë¦¬
- ë°©ì•ˆ B (IP Geolocation): VPN ì‚¬ìš©ì, í•´ì™¸ ì ‘ì† ì‹œ ë¶€ì •í™•
- ë°©ì•ˆ C (ê²€ìƒ‰ ì§€ì—­): ê²€ìƒ‰/í•„í„° ì•ˆ ì“°ëŠ” ì‚¬ìš©ìëŠ” `ë¯¸ë¶„ë¥˜`

### 5.3 íŒ€ì› í™•ì¸ í•„ìš”ì‚¬í•­

- ~~`~~~alt` í¬ë¡¤ëŸ¬: ì–´ë–¤ ì›Œí¬í”Œë¡œìš°/íŒŒì¼ì¸ì§€ í™•ì¸~~ â†’ âœ… í™•ì¸ ì™„ë£Œ (Edge Function ë°°í¬ ì›Œí¬í”Œë¡œìš°)
- í˜„ì¬ í”„ë¡œë•ì…˜ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ê´€ë¦¬ì ê²½ë¡œ í™•ì¸

---

## 6. ì°¸ê³  íŒŒì¼ ëª©ë¡

### ì‚­ì œ/ìˆ˜ì • ëŒ€ìƒ

| íŒŒì¼ | ì•¡ì…˜ |
|------|------|
| `src/pages/AdminPage.tsx` | ì‚­ì œ ë˜ëŠ” deprecated |
| `src/pages/TeamConsolePage.tsx` | í†µí•© ìˆ˜ì • |
| `src/main.tsx` | ë¼ìš°íŒ… ì •ë¦¬ |
| `src/lib/hooks/useAdminAuth.ts` | ì‚¬ìš©ì²˜ í™•ì¸ í›„ ì •ë¦¬ |

### ìˆ˜ì • ëŒ€ìƒ

| íŒŒì¼ | ìˆ˜ì • ë‚´ìš© |
|------|-----------|
| `src/lib/hooks/useActivityTracking.ts` | ì§€ì—­ ì •ë³´ ìˆ˜ì§‘ ë¡œì§ ì¶”ê°€ |
| `src/components/admin/dashboard/RegionStats.tsx` | 'ê¸°íƒ€/ë¯¸ë¶„ë¥˜' ì§€ì› |
| `supabase/functions/dashboard-analytics/index.ts` | ë¡œê¹… ì¶”ê°€ (ì„ íƒ) |

---

## 7. ê²°ë¡ 

1. **ê´€ë¦¬ì í˜ì´ì§€ í†µí•©**: TeamConsolePage ì¤‘ì‹¬ìœ¼ë¡œ ì¼ì›í™”
2. **ê¶Œí•œ ê°„ì†Œí™”**: ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ë§Œìœ¼ë¡œ ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼
3. **ì§€ì—­ í†µê³„ ìˆ˜ì •**: ì‚¬ìš©ì ê´€ì‹¬ì§€ì—­ ê¸°ë°˜ ìˆ˜ì§‘ (ë°©ì•ˆ A ê¶Œì¥)
4. **ì½”ë“œ ì •ë¦¬**: AdminPage ì‚­ì œë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

---

*ì‘ì„±: Claude Code*

---

## v2 ì—…ë°ì´íŠ¸ (2026-01-27)

### ğŸ”´ ì§€ì—­ í†µê³„ ê´€ë ¨ ì¤‘ìš” ì •ì •

**ê¸°ì¡´ ì§„ë‹¨ ì˜¤ë¥˜ (ë°©ì•ˆ A):**
- âŒ "íšŒì›ê°€ì… í¼ì—ì„œ ê´€ì‹¬ì§€ì—­ ì…ë ¥" â†’ **íšŒì›ê°€ì… í¼ ìì²´ê°€ ì—†ìŒ!**

**ì‹¤ì œ í˜„í™©:**
- âœ… `useGeolocation` í›… **ì´ë¯¸ êµ¬í˜„ë˜ì–´ ì‘ë™ ì¤‘**
- âœ… ë¸Œë¼ìš°ì € ìœ„ì¹˜ì •ë³´ API (navigator.geolocation) ì‚¬ìš©
- âœ… Kakao REST APIë¡œ ì¢Œí‘œâ†’ì£¼ì†Œ ë³€í™˜ ì™„ë£Œ
- âœ… App.tsx Line 188ì—ì„œ useGeolocation í˜¸ì¶œ ì¤‘
- âŒ **localStorage ë°ì´í„° ì €ì¥/ì½ê¸° êµ¬ì¡° ë¶ˆì¼ì¹˜ë¡œ ëª» ì½ìŒ**

---

### í•µì‹¬ ë¬¸ì œ: ë°ì´í„° êµ¬ì¡° ë¶ˆì¼ì¹˜

**ì €ì¥ (useGeolocation.ts Line 72-77):**
```typescript
localStorage.setItem('user_location', JSON.stringify({
  coords: { latitude: 37.5, longitude: 127.1 },
  address: {                    // â† address ê°ì²´ ì•ˆì— ì €ì¥
    city: "ì„±ë‚¨",
    district: "ë¶„ë‹¹"
  },
  timestamp: 1706345678901
}));
```

**ì½ê¸° (useActivityTracking.ts Line 31-44 í˜„ì¬ ì½”ë“œ):**
```typescript
const getRegionInfo = (): { city?: string; district?: string } => {
  const cached = localStorage.getItem('user_location');
  if (cached) {
    const parsed = JSON.parse(cached);
    return {
      city: parsed.city,        // âŒ undefined (ìµœìƒìœ„ì— city ì—†ìŒ!)
      district: parsed.district // âŒ undefined
    };
  }
  return {};
};
```

---

### âœ… í•´ê²°ì±…: ë‹¨ 1ì¤„ë§Œ ìˆ˜ì •

**íŒŒì¼:** `src/lib/hooks/useActivityTracking.ts`
**ë¼ì¸:** 35-36

**Before:**
```typescript
city: parsed.city,
district: parsed.district,
```

**After:**
```typescript
city: parsed.address?.city || undefined,
district: parsed.address?.district || undefined,
```

**ì‘ì—… ì‹œê°„:** 5ë¶„
**íš¨ê³¼:** ì§€ì—­ë³„ í†µê³„ ì¦‰ì‹œ ì‘ë™

---

### ìœ„ì¹˜ì •ë³´ ìˆ˜ì§‘ íë¦„ (í˜„ì¬ ì‹œìŠ¤í…œ)

```
ì‚¬ìš©ì ì ‘ì†
    â†“
App.tsx â†’ useGeolocation() ìë™ í˜¸ì¶œ
    â†“
ë¸Œë¼ìš°ì €: "ìœ„ì¹˜ì •ë³´ í—ˆìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" íŒì—…
    â†“
    â”œâ”€ í—ˆìš©
    â”‚   â†“
    â”‚  navigator.geolocation.getCurrentPosition()
    â”‚   â†“
    â”‚  ì¢Œí‘œ íšë“ (latitude, longitude)
    â”‚   â†“
    â”‚  Kakao REST API í˜¸ì¶œ (reverseGeocode)
    â”‚   â†“
    â”‚  ì£¼ì†Œ ë³€í™˜ ("ê²½ê¸°ë„ ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬")
    â”‚   â†“
    â”‚  localStorage ì €ì¥ (24ì‹œê°„ ìºì‹œ)
    â”‚   {
    â”‚     coords: {...},
    â”‚     address: { city: "ì„±ë‚¨", district: "ë¶„ë‹¹" },
    â”‚     timestamp: ...
    â”‚   }
    â”‚
    â””â”€ ê±°ë¶€ â†’ ë¯¸ë¶„ë¥˜ ì²˜ë¦¬
```

---

### ì •í™•ë„ ë° ì œí•œì‚¬í•­

**ì •í™•ë„:**
- **ëª¨ë°”ì¼ (GPS):** ë§¤ìš° ë†’ìŒ (ìˆ˜ì‹­ ë¯¸í„°)
- **ë°ìŠ¤í¬í†± (Wi-Fi/IP):** ì¤‘ê°„ (ìˆ˜ë°± ë¯¸í„°~ìˆ˜ km)

**ì œí•œì‚¬í•­:**
- ìœ„ì¹˜ì •ë³´ ê±°ë¶€ ì‚¬ìš©ì: ë¯¸ë¶„ë¥˜ ì²˜ë¦¬ (ì¼ë°˜ì ìœ¼ë¡œ 30-50%)
- VPN ì‚¬ìš©ì: ë¶€ì •í™• ê°€ëŠ¥
- í•´ì™¸ ì ‘ì†: Kakao API í•œêµ­ ì™¸ ì§€ì—­ ì œí•œì 

---

### ìˆ˜ì •ëœ ì‘ì—… ìš°ì„ ìˆœìœ„

**Phase 2: ëŒ€ì‹œë³´ë“œ í†µê³„ ìˆ˜ì • (5~30ë¶„)**

1. [ ] useActivityTracking.ts Line 35-36 ìˆ˜ì • (5ë¶„)
2. [ ] RegionStats.tsxì— 'ë¯¸ë¶„ë¥˜' í‘œì‹œ ì¶”ê°€ (ì„ íƒ, +10ë¶„)
3. [ ] í…ŒìŠ¤íŠ¸: ìœ„ì¹˜ì •ë³´ í—ˆìš© í›„ ì ‘ì†í•˜ì—¬ í†µê³„ í™•ì¸

**ì´ ì˜ˆìƒ ì‘ì—… ì‹œê°„:**
- Phase 1 (ê´€ë¦¬ì í˜ì´ì§€ í†µí•©): 30ë¶„~1ì‹œê°„
- Phase 2 (ì§€ì—­ í†µê³„ ìˆ˜ì •): **5~30ë¶„** (ê¸°ì¡´ 2~3ì¼ â†’ ëŒ€í­ ë‹¨ì¶•)
- **í•©ê³„: ì•½ 1~1.5ì‹œê°„**

---
