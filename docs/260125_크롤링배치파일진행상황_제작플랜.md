# 크롤링 배치파일 실시간 진행상황 모니터링 시스템

## 📋 목표

35개 크롤러 실행 시 **터미널 기반 실시간 대시보드**를 통해 진행 상황을 시각적으로 파악

---

## 🎯 핵심 요구사항

### 1. 시각적 요소
- ✅ **진행률 바**: `[████████░░░░░░░░] 35% (12/35)` 형태
- ✅ **실시간 상태**: 각 지역별 상태 표시 (⏳대기 / 🔄진행중 / ✅완료 / ❌실패)
- ✅ **통계 패널**: 성공/실패/총계, 소요시간, 신규 공고 수
- ✅ **스크롤 로그**: 최근 10개 작업 로그 표시
- ✅ **색상 코딩**: 성공(녹색), 실패(빨강), 진행중(노랑), 대기(회색)

### 2. 정보 표시
```
╔════════════════════════════════════════════════════════════════════╗
║  📊 35개 크롤러 실행 현황                    [2026-01-25 11:42:35] ║
╠════════════════════════════════════════════════════════════════════╣
║  진행률: [████████████████░░░░] 80% (28/35)                         ║
║  소요시간: 42분 18초 | 남은시간: 약 11분                             ║
╠════════════════════════════════════════════════════════════════════╣
║  📈 통계                                                            ║
║    성공: 26개 | 실패: 2개 | 진행중: 1개 | 대기: 6개                  ║
║    신규 공고: 147개 | 중복 스킵: 892개                               ║
╠════════════════════════════════════════════════════════════════════╣
║  🗺️  지역별 현황                                                    ║
║    광역시도 (17개)                                                  ║
║      ✅ seoul      ✅ busan      ✅ daegu      ✅ incheon           ║
║      ✅ gwangju    ✅ daejeon    ✅ ulsan      ✅ sejong            ║
║      ✅ gyeonggi   ✅ gangwon    ✅ chungbuk   ✅ chungnam          ║
║      ✅ jeonbuk    ✅ jeonnam    ✅ gyeongbuk  ✅ gyeongnam         ║
║      ✅ jeju                                                        ║
║                                                                     ║
║    경기 기초지자체 (18개)                                            ║
║      ✅ seongnam   ✅ goyang     ✅ uijeongbu  ✅ namyangju         ║
║      ✅ bucheon    ✅ gimpo      ✅ gwangmyeong ✅ gwangjuhanam     ║
║      ✅ gurinamyangju ✅ anseong ✅ pyeongtaek ✅ paju              ║
║      🔄 yangpyeong ⏳ pocheon    ⏳ yeoncheon  ⏳ dongducheonyangjyu║
║      ⏳ gapyeong1  ⏳ gapyeong2                                     ║
╠════════════════════════════════════════════════════════════════════╣
║  📝 최근 활동 로그                                                  ║
║    [11:42:30] ✅ yangpyeong 완료 - 신규 4개, 중복 8개               ║
║    [11:41:55] ✅ paju 완료 - 신규 7개, 중복 12개                    ║
║    [11:41:20] ✅ pyeongtaek 완료 - 신규 9개, 중복 15개              ║
║    [11:40:48] ✅ anseong 완료 - 신규 3개, 중복 6개                  ║
║    [11:40:15] ❌ busan 실패 - 타임아웃 오류                         ║
║    [11:39:42] ✅ gurinamyangju 완료 - 신규 5개, 중복 9개            ║
╠════════════════════════════════════════════════════════════════════╣
║  🎯 현재 작업: yangpyeong 크롤링 중... (28/35)                      ║
║      📋 발견: 12개 | 신규: 4개 | 중복: 8개                           ║
╚════════════════════════════════════════════════════════════════════╝
```

---

## 🛠️ 기술 스택 옵션

### Option A: PowerShell 네이티브 (추천)
**장점:**
- 추가 설치 불필요
- Windows 터미널과 완벽 호환
- 색상/커서 제어 가능
- 기존 배치 파일과 통합 용이

**단점:**
- 박스 그리기가 다소 복잡
- 깜빡임 발생 가능

**구현:**
```powershell
# crawler/monitor-dashboard.ps1
[Console]::CursorVisible = $false
while ($true) {
    Clear-Host
    Draw-Box "Progress Dashboard"
    Update-ProgressBar $current $total
    Draw-RegionStatus $regionStates
    Draw-RecentLogs $logs
    Start-Sleep -Milliseconds 500
}
```

---

### Option B: Node.js + blessed (최고급)
**장점:**
- 프로페셔널한 TUI (Text User Interface)
- 스크롤, 위젯, 이벤트 처리 완벽
- 깜빡임 없는 부드러운 렌더링
- npm 라이브러리 활용

**단점:**
- blessed 패키지 설치 필요
- 별도 Node 프로세스 실행

**구현:**
```javascript
// crawler/monitor-dashboard.js
import blessed from 'blessed';

const screen = blessed.screen();
const progressBar = blessed.progressbar({
  top: 2, left: 2, width: '50%', height: 3,
  filled: 100, orientation: 'horizontal',
  style: { bar: { bg: 'green' } }
});

const logBox = blessed.log({
  top: 10, left: 2, width: '100%-4', height: '50%-10',
  border: 'line', scrollable: true, mouse: true
});

screen.render();
```

---

### Option C: HTML 실시간 대시보드 (웹 기반)
**장점:**
- 가장 시각적으로 화려함
- 브라우저에서 확인 가능
- 차트/그래프 활용 가능
- 모바일에서도 확인 가능

**단점:**
- 웹서버 필요
- 오버헤드 큼
- 터미널 느낌 부족

**구현:**
```javascript
// crawler/monitor-server.js
import express from 'express';
import { Server } from 'socket.io';

const app = express();
const io = new Server(server);

io.on('connection', (socket) => {
  socket.emit('progress', { current: 12, total: 35 });
});
```

---

## 📐 최종 선택: PowerShell + Node.js blessed 하이브리드

### 구현 전략

1. **진행 상태 파일**: `crawler/.progress.json`
   ```json
   {
     "startTime": "2026-01-25T11:00:00Z",
     "currentIndex": 12,
     "total": 35,
     "regions": {
       "seoul": { "status": "completed", "new": 6, "skipped": 9, "time": 145 },
       "busan": { "status": "running", "new": 0, "skipped": 0, "time": 0 },
       "daegu": { "status": "pending", "new": 0, "skipped": 0, "time": 0 }
     },
     "logs": [
       { "time": "11:30:00", "region": "seoul", "message": "completed - 6 new" }
     ]
   }
   ```

2. **모니터링 스크립트**: `crawler/monitor.js` (Node.js blessed)
   ```javascript
   import blessed from 'blessed';
   import fs from 'fs';

   function readProgress() {
     return JSON.parse(fs.readFileSync('.progress.json', 'utf8'));
   }

   setInterval(() => {
     const data = readProgress();
     updateUI(data);
   }, 500);
   ```

3. **진행 상태 업데이트**: `crawler/index.js` 수정
   ```javascript
   function updateProgress(region, status, stats) {
     const progress = JSON.parse(fs.readFileSync('.progress.json'));
     progress.regions[region] = { status, ...stats };
     fs.writeFileSync('.progress.json', JSON.stringify(progress, null, 2));
   }
   ```

4. **실행 통합**: `run-all-local.ps1` 수정
   ```powershell
   # .progress.json 초기화
   @{
     startTime = (Get-Date).ToString('o')
     currentIndex = 0
     total = 35
     regions = @{}
   } | ConvertTo-Json | Out-File -Encoding UTF8 .progress.json

   # 백그라운드에서 모니터 실행
   Start-Process node -ArgumentList "monitor.js" -NoNewWindow

   # 크롤러 실행
   foreach ($source in $sources) {
     node index.js --source=$source
   }
   ```

---

## 🎨 UI 디자인 상세

### 1. 색상 팔레트
```
✅ 완료 (Completed):   Green (#00FF00 / 92m)
🔄 진행중 (Running):    Yellow (#FFFF00 / 93m)
⏳ 대기 (Pending):      Gray (#808080 / 90m)
❌ 실패 (Failed):       Red (#FF0000 / 91m)
📊 제목 (Header):       Cyan (#00FFFF / 96m)
📈 통계 (Stats):        Blue (#0000FF / 94m)
```

### 2. 레이아웃 구조
```
┌─────────────────────────────────────────────────────┐
│ HEADER: 타이틀 + 시간                                │
├─────────────────────────────────────────────────────┤
│ PROGRESS BAR: [████░░░░] 50% (17/35)                │
├─────────────────────────────────────────────────────┤
│ STATS PANEL: 성공/실패/신규공고/소요시간             │
├─────────────────────────────────────────────────────┤
│ REGION GRID: 35개 지역 상태 (5x7 그리드)             │
│   ✅ ✅ ✅ ✅ ✅                                       │
│   ✅ ✅ 🔄 ⏳ ⏳                                       │
│   ...                                               │
├─────────────────────────────────────────────────────┤
│ LOG STREAM: 최근 10개 작업 로그 (스크롤)              │
├─────────────────────────────────────────────────────┤
│ FOOTER: 현재 작업 상세 정보                          │
└─────────────────────────────────────────────────────┘
```

---

## 📦 파일 구조

```
crawler/
├── monitor.js              # blessed TUI 메인 스크립트
├── monitor-components/
│   ├── ProgressBar.js      # 진행률 바 컴포넌트
│   ├── RegionGrid.js       # 지역 상태 그리드
│   ├── StatsPanel.js       # 통계 패널
│   └── LogStream.js        # 로그 스트림
├── .progress.json          # 실시간 진행 상태 (git ignore)
├── run-all-local.ps1       # 실행 스크립트 (수정)
└── index.js                # 크롤러 메인 (수정 - 상태 업데이트 로직 추가)
```

---

## 🚀 구현 단계

### Phase 1: 데이터 구조 및 파일 I/O (30분)
- [x] `.progress.json` 스키마 설계
- [ ] `index.js`에 상태 업데이트 함수 추가
- [ ] 초기화/읽기/쓰기 유틸리티 작성

### Phase 2: blessed UI 기본 구조 (1시간)
- [ ] `blessed` 패키지 설치
- [ ] 스크린 레이아웃 설정
- [ ] 박스/테두리 컴포넌트 작성
- [ ] 실시간 데이터 바인딩

### Phase 3: UI 컴포넌트 구현 (2시간)
- [ ] ProgressBar 컴포넌트 (진행률 바 + 퍼센트)
- [ ] RegionGrid 컴포넌트 (35개 상태 아이콘)
- [ ] StatsPanel 컴포넌트 (통계 숫자)
- [ ] LogStream 컴포넌트 (스크롤 로그)

### Phase 4: 실시간 업데이트 로직 (1시간)
- [ ] 500ms 간격 파일 폴링
- [ ] 변경 감지 및 UI 업데이트
- [ ] 애니메이션 효과 (진행 바 이동)

### Phase 5: 통합 및 테스트 (1시간)
- [ ] `run-all-local.ps1` 수정
- [ ] 백그라운드 모니터 자동 실행
- [ ] 종료 시 정리 로직
- [ ] 오류 처리 및 예외 케이스

### Phase 6: 부가 기능 (선택)
- [ ] 키보드 단축키 (q=종료, r=새로고침, space=일시정지)
- [ ] 소리 알림 (완료 시 beep)
- [ ] 실패 시 상세 오류 팝업
- [ ] 완료 후 요약 리포트 저장

---

## 🎬 실행 시나리오

### 사용자 관점

1. **실행**
   ```powershell
   cd c:\PRODUCT\SellmeBuyme\crawler
   .\run-all-local.ps1
   ```

2. **자동으로 새 창에서 모니터 실행**
   - 터미널 대시보드가 실시간으로 업데이트됨
   - 진행률 바가 부드럽게 증가
   - 완료된 지역은 ✅로 표시
   - 실패한 지역은 ❌로 표시

3. **모니터링**
   - 현재 몇 번째 작업 중인지 확인
   - 신규 공고가 몇 개나 발견되었는지 실시간 확인
   - 실패한 지역 즉시 파악

4. **완료**
   - 전체 요약 통계 표시
   - 자동으로 `verify-crawl-results.js` 실행 제안
   - 모니터 창 자동 종료 또는 유지 선택

---

## 🔧 기술적 고려사항

### 성능
- 파일 I/O를 최소화하기 위해 버퍼링
- UI 업데이트는 변경된 부분만 다시 그리기
- blessed의 가상 DOM 활용

### 안정성
- `.progress.json` 파싱 실패 시 복구
- 모니터 프로세스 비정상 종료 시 재시작
- 크롤러 프로세스와 독립적으로 실행

### 사용성
- 터미널 크기 변경 감지 및 반응형 레이아웃
- 마우스 스크롤 지원 (로그 영역)
- 색상 미지원 터미널 fallback

---

## 📊 예상 효과

### Before (현재)
- ❌ 진행 상황 파악 불가
- ❌ 실패 여부를 끝까지 기다려야 알 수 있음
- ❌ 중간 결과 확인 불가
- ❌ 신규 공고 수 집계 안 됨

### After (구현 후)
- ✅ 실시간 진행률 확인
- ✅ 즉시 실패 감지 및 대응 가능
- ✅ 중간 통계 확인 가능
- ✅ 시각적으로 직관적인 모니터링
- ✅ 소요 시간 예측 가능

---

## 🎯 성공 기준

1. ✅ 35개 크롤러의 실시간 상태를 한눈에 파악 가능
2. ✅ 신규 공고 발견 개수 실시간 집계
3. ✅ 실패한 지역 즉시 식별 가능
4. ✅ 전체 소요 시간 및 남은 시간 예측 표시
5. ✅ 터미널에서 부드럽게 작동 (깜빡임 최소화)
6. ✅ 완료 후 자동으로 검증 스크립트 실행 연계

---

## 📝 다음 단계

1. **blessed 설치**
   ```bash
   cd crawler
   npm install blessed
   ```

2. **프로토타입 제작**
   - 기본 UI 레이아웃 구현
   - 더미 데이터로 테스트

3. **실제 데이터 연동**
   - `index.js` 수정
   - `.progress.json` 업데이트 로직

4. **통합 테스트**
   - 5개 크롤러로 먼저 테스트
   - 전체 35개 실행

5. **최적화 및 배포**
   - 성능 개선
   - 사용자 피드백 반영

---

## 🎨 UI 목업 (ASCII Art)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                   📊 셀미바이미 35개 크롤러 실행 현황                          ║
║                              2026-01-25 11:42:35                              ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║  진행률: [████████████████████████████████████░░░░░░░] 80.0% (28/35)         ║
║                                                                               ║
║  ⏱️  소요시간: 42분 18초  |  ⏳ 예상 남은 시간: 약 11분                       ║
║                                                                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║  📈 실시간 통계                                                               ║
║                                                                               ║
║      ✅ 성공: 26개  |  ❌ 실패: 2개  |  🔄 진행중: 1개  |  ⏳ 대기: 6개        ║
║                                                                               ║
║      📋 전체 공고: 1,039건  |  🆕 신규: 147건  |  ⏭️  중복: 892건            ║
║                                                                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║  🗺️  지역별 현황                                                              ║
║                                                                               ║
║    광역시도 (17개)                                                            ║
║      ✅ seoul        ✅ busan        ✅ daegu        ✅ incheon               ║
║      ✅ gwangju      ✅ daejeon      ✅ ulsan        ✅ sejong                ║
║      ✅ gyeonggi     ✅ gangwon      ✅ chungbuk     ✅ chungnam              ║
║      ✅ jeonbuk      ✅ jeonnam      ✅ gyeongbuk    ✅ gyeongnam             ║
║      ✅ jeju                                                                  ║
║                                                                               ║
║    경기 기초지자체 (18개)                                                     ║
║      ✅ seongnam     ✅ goyang       ✅ uijeongbu    ✅ namyangju             ║
║      ✅ bucheon      ✅ gimpo        ✅ gwangmyeong  ✅ gwangjuhanam          ║
║      ✅ gurinamyangju ✅ anseong     ✅ pyeongtaek   ✅ paju                  ║
║      🔄 yangpyeong   ⏳ pocheon      ⏳ yeoncheon    ⏳ dongducheonyangjyu   ║
║      ⏳ gapyeong1    ⏳ gapyeong2                                             ║
║                                                                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║  📝 최근 활동 로그 (실시간)                                                   ║
║                                                                               ║
║    [11:42:30] ✅ yangpyeong 완료 - 신규 4개, 중복 8개 (3분 12초 소요)         ║
║    [11:41:55] ✅ paju 완료 - 신규 7개, 중복 12개 (2분 45초 소요)              ║
║    [11:41:20] ✅ pyeongtaek 완료 - 신규 9개, 중복 15개 (3분 8초 소요)         ║
║    [11:40:48] ✅ anseong 완료 - 신규 3개, 중복 6개 (1분 52초 소요)            ║
║    [11:40:15] ❌ busan 실패 - 네트워크 타임아웃 오류                          ║
║    [11:39:42] ✅ gurinamyangju 완료 - 신규 5개, 중복 9개 (2분 23초 소요)      ║
║    [11:39:05] ✅ gwangjuhanam 완료 - 신규 6개, 중복 11개 (2분 38초 소요)      ║
║    [11:38:30] ✅ gwangmyeong 완료 - 신규 4개, 중복 7개 (1분 58초 소요)        ║
║                                                                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║  🎯 현재 작업 중                                                              ║
║                                                                               ║
║      지역: yangpyeong (28/35)                                                 ║
║      진행: 크롤링 중... (12개 발견, 신규 4개, 중복 8개)                        ║
║      경과: 2분 45초                                                           ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

Press 'Q' to quit  |  'R' to refresh  |  'Space' to pause
```

---

## 💡 추가 아이디어

### 1. 소리 알림
- 완료 시: 띵동~ (Windows 알림음)
- 실패 시: 경고음
- 전체 완료: 팡파레

### 2. 디스코드/슬랙 알림 연동
- 완료 시 메시지 전송
- 실패 시 즉시 알림

### 3. 과거 기록 저장
- `.progress-history/` 폴더에 날짜별 저장
- 통계 비교 (어제 vs 오늘)

### 4. 웹 대시보드 버전
- 실시간 차트 (Chart.js)
- 모바일 접근 가능
- 여러 사람이 동시에 모니터링

---

**제작 예상 시간: 4-6시간**
**난이도: ⭐⭐⭐☆☆ (중)**
**효과: ⭐⭐⭐⭐⭐ (최고)**
