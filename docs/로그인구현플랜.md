# 로그인/회원가입 구현 플랜

> 작성일: 2026-01-12
> 목표: 기존 복잡한 구조를 단순화하고, 소셜 로그인 중심의 간결한 인증 시스템 구현

---

## 1. 현재 구현 상황 분석

### 1.1 기존 파일 구조

```
src/
├── stores/
│   └── authStore.ts              # ✅ Zustand 기반 인증 상태 관리 (잘 되어 있음)
├── lib/supabase/
│   ├── client.ts                 # ✅ Supabase 클라이언트 (기본 설정 완료)
│   └── profiles.ts               # ⚠️ 프로필 관리 (너무 복잡함)
├── pages/
│   └── AuthCallback.tsx          # ✅ OAuth 콜백 처리 (잘 되어 있음)
├── components/
│   ├── auth/
│   │   ├── SocialSignupModal.tsx    # ⚠️ PC용 모달 (디자인 개선 필요)
│   │   ├── ProfileSetupModal.tsx    # ❌ 너무 복잡, 24KB 크기 (간소화 필요)
│   │   ├── ProfileViewModal.tsx     # ⚠️ 프로필 보기 (선택적 유지)
│   │   └── ProfileStep*.tsx         # ❌ 단계별 프로필 설정 (제거 대상)
│   ├── mobile/
│   │   └── MobileAuthPage.tsx       # ⚠️ 모바일 전용 인증 (통합 필요)
│   └── layout/
│       └── Header.tsx               # ⚠️ 로그인/회원가입 버튼 및 로직
└── main.tsx                      # ✅ 라우팅 (/auth/callback 등)
```

### 1.2 현재 인증 플로우

```
[사용자] → "회원가입" 클릭 → [SocialSignupModal] → 구글/카카오 선택
                                     ↓
                        [Supabase OAuth signInWithOAuth]
                                     ↓
                        [Redirect → /auth/callback]
                                     ↓
                              [AuthCallback.tsx]
                                     ↓
                        [세션 설정 → authStore 업데이트]
                                     ↓
                        [프로필 존재 확인]
                           ↓                ↓
                      [있음]            [없음]
                        ↓                  ↓
                    [홈으로]        [ProfileSetupModal 열림]
```

### 1.3 기존 소셜 로그인 로직 (재사용 가능)

**Header.tsx / App.tsx에서 사용 중인 핵심 로직:**
```typescript
const handleSelectProvider = async (provider: AuthProvider) => {
  setLoadingProvider(provider);
  const redirectTo = `${window.location.origin}/auth/callback`;
  const { error } = await supabase.auth.signInWithOAuth({
    provider,
    options: {
      redirectTo,
      queryParams: provider === 'kakao' ? { prompt: 'login' } : undefined
    }
  });
};
```

### 1.4 현재 문제점

| 문제 | 설명 |
|------|------|
| **프로필 설정 과도하게 복잡** | ProfileSetupModal이 24KB, 6단계 스텝 - 사용자 이탈 유발 |
| **모달 디자인 촌스러움** | 이모지(⏳, 🔵, 💬) 과다 사용, 하이라이트 색상 조악함 |
| **PC/모바일 분리** | SocialSignupModal과 MobileAuthPage가 별도 구현됨 |
| **불필요한 백업 파일** | ProfileSetupModal_backup.tsx, ProfileSetupModalNew.tsx 존재 |

---

## 2. 새로운 설계 방향

### 2.1 핵심 원칙

1. **소셜 로그인 = 회원가입 = 로그인**
   - 구글/카카오 연동하면 자동으로 Supabase auth.users에 등록됨
   - 별도 회원가입 폼 없음

2. **프로필 설정 최소화 (선택 사항)**
   - 필수: 없음 (이메일은 소셜에서 자동 획득)
   - 선택: 닉네임, 관심 지역 (나중에 설정 가능)

3. **미니멀 디자인**
   - 이모지 사용 금지
   - 흰색 배경 + 회색 텍스트 + 포인트 컬러(#7aa3cc 또는 브랜드 컬러)
   - 카카오/구글 버튼은 공식 스타일 가이드 준수

### 2.2 새로운 플로우

```
[사용자] → "로그인" 또는 "회원가입" 클릭 → [AuthModal]
                                            ↓
                                [구글로 계속하기] 또는 [카카오로 계속하기]
                                            ↓
                                [Supabase OAuth]
                                            ↓
                                [/auth/callback]
                                            ↓
                                [세션 설정 완료]
                                            ↓
                                [홈으로 리다이렉트]
```

**프로필 설정은 별도 경로로 분리:**
- 마이페이지에서 "프로필 완성하기" 버튼으로 유도
- 필수가 아닌 선택 사항으로 변경

---

## 3. 구현 계획

### 3.1 Phase 1: 새 AuthModal 컴포넌트 생성

**파일:** `src/components/auth/AuthModal.tsx`

**디자인 스펙:**
- 배경: 흰색 (#ffffff)
- 테두리: 없음 또는 매우 연한 회색 (border-gray-100)
- 그림자: shadow-lg (부드러운 드롭 쉐도우)
- 폰트: 본문 text-gray-700, 제목 text-gray-900
- 버튼:
  - 구글: 흰색 배경, 검정 텍스트, 회색 테두리 (공식 스타일)
  - 카카오: #FEE500 배경, #000000 텍스트 (공식 스타일)
  - 아이콘은 공식 SVG 또는 Tabler Icons 사용 (이모지 금지)

**새 모달 예시 구조:**
```tsx
<motion.div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
  <motion.div className="w-full max-w-sm mx-4 bg-white rounded-2xl shadow-xl p-6">
    {/* 헤더 */}
    <div className="flex justify-between items-center mb-6">
      <h2 className="text-lg font-semibold text-gray-900">로그인</h2>
      <button onClick={onClose}><IconX size={20} className="text-gray-400" /></button>
    </div>

    {/* 소셜 로그인 버튼 */}
    <div className="space-y-3">
      <button className="w-full flex items-center justify-center gap-2 h-12 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
        <GoogleIcon className="w-5 h-5" />
        Google로 계속하기
      </button>
      <button className="w-full flex items-center justify-center gap-2 h-12 bg-[#FEE500] rounded-lg text-sm font-medium text-[#000000] hover:bg-[#FDD835] transition-colors">
        <KakaoIcon className="w-5 h-5" />
        카카오로 계속하기
      </button>
    </div>

    {/* 푸터 */}
    <p className="mt-6 text-center text-xs text-gray-400">
      계속하면 이용약관 및 개인정보처리방침에 동의하는 것으로 간주됩니다.
    </p>
  </motion.div>
</motion.div>
```

### 3.2 Phase 2: 기존 로직 재사용

**유지할 파일:**
- `src/stores/authStore.ts` - 그대로 사용
- `src/pages/AuthCallback.tsx` - 그대로 사용
- `src/lib/supabase/client.ts` - 그대로 사용

**수정할 파일:**
- `src/pages/new-landing/components/Hero.tsx` - 로그인/회원가입 버튼에 새 AuthModal 연결
- `src/components/layout/Header.tsx` - 기존 SocialSignupModal 대신 새 AuthModal 사용

**제거 또는 보류할 파일:**
- `src/components/auth/ProfileSetupModal.tsx` - 일단 보류, 나중에 간소화 버전으로 대체
- `src/components/auth/ProfileStep*.tsx` (6개 파일) - 제거 대상
- `src/components/mobile/MobileAuthPage.tsx` - 새 AuthModal로 통합 (반응형)

### 3.3 Phase 3: Hero.tsx에 AuthModal 연결

**현재 Hero.tsx의 로그인/회원가입 버튼 위치:**
- 줄 818-824: 로그인/회원가입 버튼 렌더링 (z-20, 맵 위에 떠있음)

**변경 계획:**
```tsx
// 상태 추가
const [isAuthModalOpen, setAuthModalOpen] = useState(false);

// 버튼 클릭 핸들러
const handleAuthClick = () => setAuthModalOpen(true);

// 기존 버튼 두 개를 하나로 통합하거나, 둘 다 같은 모달 열기
<button onClick={handleAuthClick}>로그인</button>
<button onClick={handleAuthClick}>시작하기</button>

// 모달 렌더링
<AuthModal 
  isOpen={isAuthModalOpen} 
  onClose={() => setAuthModalOpen(false)} 
/>
```

### 3.4 Phase 4: AuthCallback 개선

**현재 동작:**
1. 소셜 로그인 성공
2. 세션 설정
3. 프로필 존재 확인
4. 없으면 sessionStorage에 `profileSetupPending` 설정
5. 홈으로 리다이렉트
6. App.tsx에서 `profileSetupPending` 감지 → ProfileSetupModal 열기

**새로운 동작:**
1. 소셜 로그인 성공
2. 세션 설정
3. **프로필 설정 강요 없이** 바로 홈으로 리다이렉트
4. 프로필 완성은 마이페이지에서 선택적으로 진행

**수정 사항 (AuthCallback.tsx):**
```typescript
// 기존: 프로필 없으면 sessionStorage 설정
// 변경: 프로필 유무와 상관없이 바로 홈으로
const userId = userData.user.id;
await ensureAuthInitialized();
window.location.replace('/');
```

---

## 4. 디자인 가이드

### 4.1 색상 팔레트

| 용도 | 색상 | HEX |
|------|------|-----|
| 배경 | 흰색 | #FFFFFF |
| 본문 텍스트 | 다크 그레이 | #374151 (gray-700) |
| 보조 텍스트 | 미디엄 그레이 | #9CA3AF (gray-400) |
| 구글 버튼 배경 | 흰색 | #FFFFFF |
| 구글 버튼 테두리 | 라이트 그레이 | #D1D5DB (gray-300) |
| 카카오 버튼 배경 | 카카오 옐로우 | #FEE500 |
| 카카오 버튼 텍스트 | 블랙 | #000000 |
| 닫기 버튼 | 라이트 그레이 | #9CA3AF |
| 호버 효과 | 매우 연한 그레이 | #F9FAFB (gray-50) |

### 4.2 타이포그래피

- 모달 제목: `text-lg font-semibold text-gray-900`
- 버튼 텍스트: `text-sm font-medium`
- 푸터 텍스트: `text-xs text-gray-400`

### 4.3 금지 사항

- ❌ 이모지 사용 (⏳, 🔵, 💬, 📧 등)
- ❌ 그라데이션 배경 (except 브랜드 로고)
- ❌ 밝은 파란색 하이라이트 배경 (`bg-[#F4F8FF]` 등)
- ❌ description 텍스트 ("Google 계정으로 빠르게 가입하세요" 같은 불필요한 설명)

---

## 5. 구현 우선순위

| 순위 | 작업 | 예상 시간 |
|------|------|----------|
| 1 | 새 AuthModal 컴포넌트 생성 | 30분 |
| 2 | Hero.tsx에 연결 | 15분 |
| 3 | AuthCallback.tsx 간소화 | 10분 |
| 4 | 기존 로그인 버튼들 AuthModal로 교체 | 20분 |
| 5 | 구 파일 정리 (제거/보류) | 10분 |

---

## 6. 참고: 기존 Supabase 설정 확인 필요

### OAuth Provider 설정

Supabase Dashboard → Authentication → Providers에서 확인:

1. **Google OAuth**
   - Client ID / Client Secret 설정 완료 여부
   - Redirect URL: `https://[project].supabase.co/auth/v1/callback`

2. **Kakao OAuth**
   - REST API Key 설정 완료 여부
   - JavaScript 키 (선택)
   - Redirect URL 설정

### 현재 redirectTo 설정

```typescript
const redirectTo = `${window.location.origin}/auth/callback`;
// 로컬: http://localhost:5173/auth/callback
// 프로덕션: https://yourdomain.com/auth/callback
```

---

## 7. 결론

기존 구현은 **소셜 로그인 연동 부분**이 이미 잘 되어 있습니다. 
문제는 **프로필 설정이 너무 복잡**하고, **모달 디자인이 촌스럽다**는 점입니다.

**핵심 전략:**
1. 새로운 미니멀 AuthModal 생성 (이모지 없음, 깔끔한 디자인)
2. 프로필 설정 강요 제거 (선택 사항으로 변경)
3. 기존 OAuth 로직은 그대로 재사용
4. PC/모바일 통합 (반응형 모달 하나로)

이렇게 하면 복잡한 기존 코드를 대부분 유지하면서, 사용자 경험만 대폭 개선할 수 있습니다.
