# 관리자 페이지 콘텐츠 관리 개선 계획

**작성일**: 2026-01-31
**상태**: 계획 단계

---

## 1. 현재 등록 플로우 및 백엔드 구조

### 1.1 등록 버튼 위치

**데스크톱 (LayerToggleBar.tsx)**
```
┌──────────────┐
│   로그인     │
│══════════════│
│  + 구직등록  │ → teacher_markers
│──────────────│
│  + 공고등록  │ → job_postings
│──────────────│
│ 교원연수     │ → instructor_markers
│ 강사등록     │
└──────────────┘
```

**모바일 (MobileRegisterNav.tsx)**
```
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│공고보기 │구직보기 │구직등록 │공고등록 │강사등록 │즐겨찾기 │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
```

### 1.2 등록 플로우

#### 공고등록 (job_postings)
```
공고등록 클릭
    ↓
로그인 체크 → (미로그인) → AuthModal
    ↓
FullScreenLocationPicker (위치 선택)
    ↓
JobPostingModal (폼 입력)
├─ 조직명 (필수)
├─ 학교급 (선택)
├─ 공고제목 (필수)
├─ 1차/2차 분류
├─ 마감일, 긴급여부
├─ 근무기간
├─ 상세설명
├─ 첨부파일
├─ 연락처
└─ 개인정보 동의
    ↓
Supabase: job_postings INSERT
    ↓
지도에 마커 표시
```

#### 구직등록 (teacher_markers)
```
구직등록 클릭
    ↓
Early Access 체크 → (없음) → ComingSoonModal
    ↓
로그인 체크 → (미로그인) → AuthModal
    ↓
TeacherMarkerModal (폼 입력)
├─ 위치 정보 (RegionSearchInput)
├─ 닉네임, 이메일
├─ 1차 분류 (8개 중 단일)
├─ 2차 분류 (복수)
├─ 희망 학교급
├─ 경력
├─ 활동가능 지역 (다중)
├─ 자기소개
├─ 프로필 사진
└─ 개인정보 동의
    ↓
Supabase: teacher_markers INSERT
    ↓
지도에 마커 표시
```

#### 교원연수 강사등록 (instructor_markers)
```
강사등록 클릭
    ↓
Early Access 체크 → (없음) → ComingSoonModal
    ↓
InstructorInfoModal (안내)
    ↓
로그인 체크 → (미로그인) → AuthModal
    ↓
InstructorMarkerModal (폼 입력)
├─ 위치 정보
├─ 닉네임, 이메일
├─ 전문분야 (20개 중 복수)
├─ 기타 전문분야
├─ 연수 대상 (교원/학부모/교직원/기타)
├─ 활동가능 지역 (다중)
├─ 경력년수
├─ 활동내용
├─ 프로필 사진
└─ 개인정보 동의
    ↓
Supabase: instructor_markers INSERT
    ↓
지도에 마커 표시
```

### 1.3 백엔드 테이블 구조

#### job_postings 테이블
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | UUID | PK |
| user_id | UUID | FK → auth.users |
| organization | VARCHAR(255) | 조직명 (필수) |
| title | TEXT | 공고제목 (필수) |
| content | TEXT | 상세설명 |
| primary_category | VARCHAR(50) | 1차 분류 |
| sub_categories | TEXT[] | 2차 분류 |
| school_level | VARCHAR(50) | 학교급 |
| deadline | DATE | 마감일 |
| is_urgent | BOOLEAN | 긴급여부 |
| work_period | VARCHAR(255) | 근무기간 |
| location | VARCHAR(255) | 주소 |
| latitude/longitude | DECIMAL | 좌표 |
| contact_phone | VARCHAR(20) | 연락처 |
| attachment_url | TEXT | 첨부파일 URL |
| source | VARCHAR(20) | 'user_posted' / 'crawled' |
| created_at | TIMESTAMPTZ | 등록일 |

#### teacher_markers 테이블
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | UUID | PK |
| user_id | UUID | FK → auth.users |
| nickname | VARCHAR(50) | 닉네임 |
| email | VARCHAR(255) | 이메일 |
| primary_category | VARCHAR(50) | 1차 분류 |
| sub_categories | TEXT[] | 2차 분류 |
| preferred_school_levels | TEXT[] | 희망 학교급 |
| experience_years | VARCHAR(20) | 경력 |
| available_regions | TEXT[] | 활동가능 지역 |
| introduction | TEXT | 자기소개 |
| profile_image_url | TEXT | 프로필 사진 |
| latitude/longitude | DECIMAL | 좌표 |
| is_active | BOOLEAN | 활성화 상태 |
| created_at | TIMESTAMPTZ | 등록일 |

#### instructor_markers 테이블
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | UUID | PK |
| user_id | UUID | FK → auth.users |
| display_name | VARCHAR(100) | 닉네임 |
| email | VARCHAR(255) | 이메일 |
| specialties | TEXT[] | 전문분야 (20개 중) |
| custom_specialty | TEXT | 기타 전문분야 |
| target_audience | TEXT[] | 연수 대상 |
| available_regions | TEXT[] | 활동가능 지역 |
| experience_years | VARCHAR(20) | 경력 |
| activity_history | TEXT | 활동내용 |
| profile_image_url | TEXT | 프로필 사진 |
| latitude/longitude | DECIMAL | 좌표 |
| is_active | BOOLEAN | 활성화 상태 |
| created_at | TIMESTAMPTZ | 등록일 |

---

## 2. RLS 정책 현황 및 해결 방안 (핵심)

### 2.1 현재 RLS 정책 상황

#### job_postings (문제 있음)
| 작업 | 정책명 | 조건 | 관리자 예외 |
|------|--------|------|-------------|
| SELECT | "Anyone can view job postings" | `true` | 불필요 |
| INSERT | "Authenticated users can insert job postings" | `auth.uid() = user_id` | 불필요 |
| UPDATE | "Users can update own job postings" | `auth.uid() = user_id` | **없음 (문제!)** |
| DELETE | "Users can delete own job postings" | `auth.uid() = user_id` | **없음 (문제!)** |

#### teacher_markers (해결됨)
| 작업 | 정책명 | 조건 | 관리자 예외 |
|------|--------|------|-------------|
| SELECT | "teacher_markers_select_public" | `is_active = true` | 불필요 |
| SELECT | "teacher_markers_select_own" | `auth.uid() = user_id` | 불필요 |
| INSERT | "teacher_markers_insert_own" | `auth.uid() = user_id` | 불필요 |
| UPDATE | "teacher_markers_update_own_or_admin" | `auth.uid() = user_id` | **Super Admin 이메일** |
| DELETE | "teacher_markers_delete_own_or_admin" | `auth.uid() = user_id` | **Super Admin 이메일** |

#### instructor_markers (해결됨)
| 작업 | 정책명 | 조건 | 관리자 예외 |
|------|--------|------|-------------|
| SELECT | "instructor_markers_select_active" | `is_active = true` | 불필요 |
| SELECT | "instructor_markers_select_own" | `auth.uid() = user_id` | 불필요 |
| INSERT | "instructor_markers_insert_own" | `auth.uid() = user_id` | 불필요 |
| UPDATE | "instructor_markers_update_own_or_admin" | `auth.uid() = user_id` | **Super Admin 이메일** |
| DELETE | "instructor_markers_delete_own_or_admin" | `auth.uid() = user_id` | **Super Admin 이메일** |

### 2.2 문제점 분석

```
┌─────────────────────────────────────────────────────────────────┐
│  문제 1: job_postings에 관리자 예외 정책 없음                    │
├─────────────────────────────────────────────────────────────────┤
│  현상: 관리자가 다른 사용자의 공고를 수정/삭제할 수 없음         │
│  원인: UPDATE/DELETE 정책이 본인만 허용                          │
│  영향: 콘텐츠 관리 기능에서 공고 관리 불가                       │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  문제 2: 관리자 판별 방식 불일치                                 │
├─────────────────────────────────────────────────────────────────┤
│  teacher_markers, instructor_markers:                            │
│    → auth.jwt()->>'email' = 'l30417305@gmail.com' (하드코딩)     │
│                                                                  │
│  user_profiles:                                                  │
│    → roles @> ARRAY['admin']::text[] (역할 기반)                 │
│                                                                  │
│  영향: 확장성 부족, 새 관리자 추가 시 마이그레이션 필요          │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 해결 방안: 통합 관리자 RLS 정책

#### 방안 A: 역할 기반 (권장)
```sql
-- 관리자 체크 함수 생성
CREATE OR REPLACE FUNCTION is_admin()
RETURNS BOOLEAN AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1 FROM user_profiles
    WHERE user_id = auth.uid()
    AND roles @> ARRAY['admin']::text[]
  );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

**장점**: 확장성, DB에서 역할 관리
**단점**: 함수 호출 오버헤드

#### 방안 B: 이메일 목록 (현재 방식 확장)
```sql
-- Super Admin 이메일 목록으로 체크
auth.jwt()->>'email' IN ('l30417305@gmail.com', 'admin2@example.com')
```

**장점**: 단순함, 빠름
**단점**: 확장성 부족, 마이그레이션 필요

### 2.4 필요한 마이그레이션 (Phase 0)

```sql
-- 20260131_admin_content_management_rls.sql

-- ============================================================================
-- 1. 관리자 체크 함수 (재사용 가능)
-- ============================================================================
CREATE OR REPLACE FUNCTION public.is_admin()
RETURNS BOOLEAN AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1 FROM public.user_profiles
    WHERE user_id = auth.uid()
    AND roles @> ARRAY['admin']::text[]
  );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER STABLE;

-- ============================================================================
-- 2. job_postings 관리자 정책 추가
-- ============================================================================

-- 기존 정책 삭제
DROP POLICY IF EXISTS "Users can update own job postings" ON job_postings;
DROP POLICY IF EXISTS "Users can delete own job postings" ON job_postings;

-- 새 정책: 본인 또는 관리자
CREATE POLICY "job_postings_update_own_or_admin" ON job_postings
  FOR UPDATE
  TO authenticated
  USING (
    auth.uid() = user_id
    OR public.is_admin()
  );

CREATE POLICY "job_postings_delete_own_or_admin" ON job_postings
  FOR DELETE
  TO authenticated
  USING (
    auth.uid() = user_id
    OR public.is_admin()
  );

-- ============================================================================
-- 3. teacher_markers 정책 통일 (이메일 → 역할 기반)
-- ============================================================================

DROP POLICY IF EXISTS "teacher_markers_update_own_or_admin" ON teacher_markers;
DROP POLICY IF EXISTS "teacher_markers_delete_own_or_admin" ON teacher_markers;

CREATE POLICY "teacher_markers_update_own_or_admin" ON teacher_markers
  FOR UPDATE
  TO authenticated
  USING (
    auth.uid() = user_id
    OR public.is_admin()
  );

CREATE POLICY "teacher_markers_delete_own_or_admin" ON teacher_markers
  FOR DELETE
  TO authenticated
  USING (
    auth.uid() = user_id
    OR public.is_admin()
  );

-- ============================================================================
-- 4. instructor_markers 정책 통일 (이메일 → 역할 기반)
-- ============================================================================

DROP POLICY IF EXISTS "instructor_markers_update_own_or_admin" ON instructor_markers;
DROP POLICY IF EXISTS "instructor_markers_delete_own_or_admin" ON instructor_markers;

CREATE POLICY "instructor_markers_update_own_or_admin" ON instructor_markers
  FOR UPDATE
  TO authenticated
  USING (
    auth.uid() = user_id
    OR public.is_admin()
  );

CREATE POLICY "instructor_markers_delete_own_or_admin" ON instructor_markers
  FOR DELETE
  TO authenticated
  USING (
    auth.uid() = user_id
    OR public.is_admin()
  );

-- ============================================================================
-- 5. 관리자 SELECT 정책 (필요시)
-- ============================================================================

-- job_postings는 이미 전체 공개이므로 불필요

-- teacher_markers: 관리자는 비활성 마커도 조회 가능
CREATE POLICY "teacher_markers_select_admin" ON teacher_markers
  FOR SELECT
  TO authenticated
  USING (public.is_admin());

-- instructor_markers: 관리자는 비활성 마커도 조회 가능
CREATE POLICY "instructor_markers_select_admin" ON instructor_markers
  FOR SELECT
  TO authenticated
  USING (public.is_admin());
```

### 2.5 RLS 정책 체크리스트

구현 전 반드시 확인:

```
□ user_profiles 테이블에 현재 사용자 roles 배열에 'admin' 포함 확인
  SELECT roles FROM user_profiles WHERE user_id = auth.uid();

□ is_admin() 함수 테스트
  SELECT public.is_admin();

□ 각 테이블별 정책 적용 확인
  SELECT policyname, cmd, qual FROM pg_policies
  WHERE tablename IN ('job_postings', 'teacher_markers', 'instructor_markers');

□ 실제 UPDATE/DELETE 테스트 (관리자 계정으로)
  UPDATE teacher_markers SET is_active = false WHERE id = 'test-id';
```

---

## 3. 콘텐츠 관리 탭 연동 설계

### 3.1 현재 상태

- **파일**: `/src/pages/AdminPage.tsx`
- **탭 key**: `'content'`
- **현재 구현**: "선택한 메뉴는 준비 중입니다." (미구현)

### 3.2 구현 목표

관리자가 **사용자 직접 등록 콘텐츠**를 관리할 수 있도록:
1. 세 가지 데이터 소스 통합 조회
2. 검색/필터링
3. 상세 보기
4. 수정/삭제/활성화 토글

### 3.3 컴포넌트 구조

```
AdminPage.tsx
└── renderTabContent() case 'content':
    └── ContentManagement.tsx (신규)
        ├── ContentTabs (공고 | 구직 | 강사)
        ├── ContentFilters (검색, 날짜, 상태)
        ├── ContentTable (목록 테이블)
        │   ├── 공고 목록 (JobPostingRow)
        │   ├── 구직자 목록 (TeacherMarkerRow)
        │   └── 강사 목록 (InstructorMarkerRow)
        └── ContentDetailModal (상세/수정)
            ├── JobPostingDetail
            ├── TeacherMarkerDetail
            └── InstructorMarkerDetail
```

### 3.4 데이터 흐름

```
ContentManagement
    │
    ├── [탭 선택] → activeTab: 'jobs' | 'teachers' | 'instructors'
    │
    ├── [필터 적용] → filters: { search, dateRange, status, category }
    │
    ├── [데이터 로드]
    │   ├── jobs: supabase.from('job_postings').select()
    │   │         .eq('source', 'user_posted')  // 사용자 등록만
    │   ├── teachers: supabase.from('teacher_markers').select()
    │   └── instructors: supabase.from('instructor_markers').select()
    │
    ├── [목록 표시] → ContentTable
    │   └── 행 클릭 → ContentDetailModal 열기
    │
    └── [관리 액션]
        ├── 수정: UPDATE 쿼리 (RLS: is_admin() 통과 필요)
        ├── 삭제: DELETE 쿼리 (RLS: is_admin() 통과 필요)
        └── 비활성화: is_active = false (Soft Delete)
```

### 3.5 필요한 신규 파일

```
src/components/admin/
├── ContentManagement.tsx       # 메인 컴포넌트
├── ContentTabs.tsx             # 탭 전환
├── ContentFilters.tsx          # 필터 UI
├── ContentTable.tsx            # 테이블 공통
├── JobPostingRow.tsx           # 공고 행
├── TeacherMarkerRow.tsx        # 구직자 행
├── InstructorMarkerRow.tsx     # 강사 행
├── ContentDetailModal.tsx      # 상세 모달
└── hooks/
    └── useContentManagement.ts # 데이터 페칭/관리 훅
```

---

## 4. 디자인 시스템 준수 (Anti-Vibe Design)

> **참조**: `.claude/skills/anti-vibe-design/SKILL.md`

### 4.1 절대 규칙

```
□ 이모지 금지 - 절대 사용하지 않음
□ 글자 뒤 배경색 금지 - 형광펜 스타일 배제
□ 과도한 원색 사용 금지 - 프로젝트 컬러 팔레트 사용
□ 바이브코딩 냄새 금지 - 어디서 가져온 듯한 스타일 배제
```

### 4.2 컬러 팔레트

| 용도 | Tailwind Class | HEX |
|------|---------------|-----|
| 메인 파랑 | `bg-[#3B82F6]` | #3B82F6 |
| 소프트 레드 | `bg-[#F87171]` | #F87171 |
| 기본 배경 | `bg-white` | #FFFFFF |
| 연한 배경 | `bg-gray-50` | #F9FAFB |
| 본문 텍스트 | `text-gray-800` | - |
| 보조 텍스트 | `text-gray-600` | - |
| 테두리 | `border-gray-200` | - |

### 4.3 컴포넌트 스타일 가이드

#### 테이블
```tsx
// 테이블 컨테이너
<div className="bg-white rounded-xl border border-gray-200 overflow-hidden">

  {/* 테이블 헤더 */}
  <div className="bg-gray-50 border-b border-gray-200 px-4 py-3">
    <div className="grid grid-cols-7 gap-4 text-sm font-medium text-gray-600">
      <span>제목</span>
      <span>분류</span>
      {/* ... */}
    </div>
  </div>

  {/* 테이블 행 */}
  <div className="divide-y divide-gray-100">
    <div className="px-4 py-3 hover:bg-gray-50 transition-colors cursor-pointer">
      {/* 행 내용 */}
    </div>
  </div>
</div>
```

#### 필터 영역
```tsx
<div className="flex items-center gap-3 mb-4">
  {/* 검색 입력 */}
  <input
    className="flex-1 px-3 py-2 text-sm bg-white border border-gray-200 rounded-lg
               placeholder:text-gray-400 focus:outline-none focus:ring-2
               focus:ring-blue-500 focus:border-transparent"
    placeholder="검색어 입력..."
  />

  {/* 필터 드롭다운 */}
  <button className="px-3 py-2 text-sm rounded-lg border bg-white border-gray-200
                     text-gray-600 hover:border-gray-300 hover:bg-gray-50
                     flex items-center gap-1">
    <span>상태</span>
    <ChevronDown size={16} />
  </button>
</div>
```

#### 탭 전환
```tsx
<div className="flex border-b border-gray-200 mb-4">
  {/* 비활성 탭 */}
  <button className="px-4 py-2 text-sm text-gray-600 hover:text-gray-800
                     border-b-2 border-transparent transition-colors">
    공고 (24)
  </button>

  {/* 활성 탭 */}
  <button className="px-4 py-2 text-sm text-[#3B82F6] font-medium
                     border-b-2 border-[#3B82F6]">
    구직 (156)
  </button>
</div>
```

#### 상태 배지
```tsx
// 활성 상태 (형광펜 스타일 금지!)
<span className="text-xs font-medium text-green-600">활성</span>

// 비활성 상태
<span className="text-xs font-medium text-gray-400">비활성</span>

// 긴급 상태
<span className="text-xs font-bold text-red-600">긴급</span>
```

#### 액션 드롭다운
```tsx
<div className="relative">
  <button className="p-1 hover:bg-gray-100 rounded transition-colors">
    <MoreVertical size={16} className="text-gray-400" />
  </button>

  {/* 드롭다운 메뉴 */}
  <div className="absolute right-0 mt-1 w-32 bg-white rounded-lg border
                  border-gray-200 shadow-lg py-1 z-10">
    <button className="w-full px-3 py-2 text-left text-sm text-gray-700
                       hover:bg-gray-50">
      상세보기
    </button>
    <button className="w-full px-3 py-2 text-left text-sm text-gray-700
                       hover:bg-gray-50">
      수정
    </button>
    <button className="w-full px-3 py-2 text-left text-sm text-red-600
                       hover:bg-red-50">
      삭제
    </button>
  </div>
</div>
```

#### 모달
```tsx
<div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
  <div className="absolute inset-0" onClick={onClose} />

  <div className="relative bg-white rounded-xl shadow-xl border border-gray-200
                  w-full max-w-2xl max-h-[90vh] overflow-hidden mx-4">
    {/* 헤더 */}
    <div className="px-6 py-4 border-b border-gray-200">
      <h2 className="text-lg font-bold text-gray-800">공고 상세 정보</h2>
    </div>

    {/* 본문 */}
    <div className="px-6 py-4 overflow-y-auto max-h-[60vh]">
      {/* 섹션 */}
      <div className="mb-6">
        <h3 className="text-sm font-medium text-gray-500 mb-2">기본 정보</h3>
        <div className="space-y-2">
          <p className="text-sm text-gray-800">
            <span className="text-gray-500">공고제목:</span> 초등담임 구합니다
          </p>
        </div>
      </div>
    </div>

    {/* 푸터 */}
    <div className="px-6 py-4 border-t border-gray-200 flex justify-end gap-3">
      <button className="px-4 py-2 text-sm bg-white border border-gray-200
                         text-gray-700 rounded-lg hover:bg-gray-50">
        닫기
      </button>
      <button className="px-4 py-2 text-sm bg-[#3B82F6] text-white
                         rounded-lg hover:bg-blue-600">
        수정하기
      </button>
    </div>
  </div>
</div>
```

### 4.4 금지 사항 예시

```tsx
// 이모지 금지
<h2>📋 콘텐츠 관리</h2>           // ❌
<h2>콘텐츠 관리</h2>               // ✓

// 형광펜 스타일 금지
<span className="bg-green-200 px-2">활성</span>      // ❌
<span className="text-green-600 font-medium">활성</span>  // ✓

// 과한 원색 금지
<div className="bg-yellow-300 text-red-500">...</div>  // ❌
<div className="bg-gray-50 text-gray-800">...</div>    // ✓

// 바이브코딩 스타일 금지
<button className="shadow-2xl rounded-full bg-gradient-to-br
                   from-blue-500 to-purple-600">  // ❌
<button className="bg-[#3B82F6] text-white rounded-lg
                   hover:bg-blue-600">            // ✓
```

---

## 5. ASCII 목업

### 5.1 콘텐츠 관리 메인 화면

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 콘텐츠 관리                                                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  공고 (24)     │  구직 (156)    │  강사 (38)                        │    │
│  │  ─────────────────────────────                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │ 검색어 입력...                     │ 날짜 ▼ │ 상태 ▼ │ 분류 ▼ │ 초기화│  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │   │ 제목/닉네임      │ 분류      │ 지역    │ 등록일     │ 상태  │    │  │
│  ├───┼─────────────────┼───────────┼─────────┼────────────┼───────┼────┤  │
│  │   │ 초등교사 구합니다│ 초등담임  │ 서울 강남│ 2026-01-30│ 활성  │ :  │  │
│  │   │ 수학 기간제 모집 │ 교과과목  │ 경기 성남│ 2026-01-29│ 활성  │ :  │  │
│  │   │ 특수교사 채용    │ 특수교육  │ 인천    │ 2026-01-28│ 비활성│ :  │  │
│  │   │ 돌봄전담사 모집  │ 방과후    │ 대전    │ 2026-01-27│ 활성  │ :  │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  < 이전  │  1  2  3  4  5  ...  │  다음 >  │    총 24건             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 공고 탭 테이블 상세

```
┌───────────────────────────────────────────────────────────────────────────────┐
│   │ 공고제목          │ 조직명     │ 분류     │ 지역   │마감일    │상태│    │
├───┼───────────────────┼────────────┼──────────┼────────┼──────────┼────┼────┤
│   │ 초등담임 구합니다  │ OO초등학교│ 초등담임 │서울 강남│2026-02-15│활성│ :  │
│   │                   │            │          │        │          │    │┌──┐│
│   │                   │            │          │        │          │    ││보기││
│   │                   │            │          │        │          │    ││수정││
│   │                   │            │          │        │          │    ││삭제││
│   │                   │            │          │        │          │    │└──┘│
├───┼───────────────────┼────────────┼──────────┼────────┼──────────┼────┼────┤
│   │ 수학교사 기간제    │ XX중학교  │ 교과과목 │경기 성남│2026-02-28│활성│ :  │
└───┴───────────────────┴────────────┴──────────┴────────┴──────────┴────┴────┘
```

### 5.3 구직 탭 테이블 상세

```
┌───────────────────────────────────────────────────────────────────────────────┐
│   │ 닉네임     │ 이메일          │ 분류     │ 활동지역 │ 경력  │상태│      │
├───┼────────────┼─────────────────┼──────────┼──────────┼───────┼────┼──────┤
│   │ 열정교사01 │ te***@gmail.com │ 교과과목 │ 서울전체 │ 3~5년 │활성│  :   │
│   │ 초등맘선생 │ ch***@naver.com │ 초등담임 │ 경기 남부│ 신입  │활성│  :   │
│   │ 특수쌤     │ sp***@daum.net  │ 특수교육 │ 인천, 경기│10년+ │비활성│ :   │
└───┴────────────┴─────────────────┴──────────┴──────────┴───────┴────┴──────┘
```

### 5.4 강사 탭 테이블 상세

```
┌───────────────────────────────────────────────────────────────────────────────┐
│   │ 닉네임     │ 이메일          │ 전문분야       │ 대상   │ 경력  │상태│   │
├───┼────────────┼─────────────────┼────────────────┼────────┼───────┼────┼───┤
│   │ AI강사김   │ ai***@gmail.com │ 에듀테크/AI    │ 교원   │ 5~10년│활성│ : │
│   │ 상담전문가 │ co***@naver.com │ 생활지도/상담  │ 교원,  │ 10년+ │활성│ : │
│   │            │                 │ 학교폭력예방   │ 학부모 │       │    │   │
│   │ 환경교육자 │ ec***@daum.net  │ 환경/탄소중립  │ 교직원 │ 3~5년 │활성│ : │
└───┴────────────┴─────────────────┴────────────────┴────────┴───────┴────┴───┘
```

### 5.5 상세 보기 모달 (공고)

```
┌─────────────────────────────────────────────────────────────────┐
│                          공고 상세 정보                     [X] │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  기본 정보                                                       │
│  ───────────────────────────────────────────────────────────    │
│  공고제목: 초등담임 구합니다                                     │
│  조직명:   OO초등학교                                            │
│  등록자:   user123@gmail.com (ID: abc-123-def)                  │
│  등록일:   2026-01-30 14:32                                      │
│                                                                  │
│  분류 정보                                                       │
│  ───────────────────────────────────────────────────────────    │
│  1차 분류: 초등담임                                              │
│  2차 분류: -                                                     │
│  학교급:   초등학교                                              │
│                                                                  │
│  모집 조건                                                       │
│  ───────────────────────────────────────────────────────────    │
│  마감일:     2026-02-15                                          │
│  긴급:       긴급공고                                            │
│  근무기간:   2026-03-01 ~ 2026-08-31                             │
│                                                                  │
│  상세 내용                                                       │
│  ───────────────────────────────────────────────────────────    │
│  초등학교 1학년 담임교사를 모집합니다.                           │
│  - 자격: 초등교사 자격증 소지자                                  │
│  - 우대: 저학년 지도 경험자                                      │
│                                                                  │
│  연락처 / 첨부                                                   │
│  ───────────────────────────────────────────────────────────    │
│  연락처:   010-1234-5678                                         │
│  첨부파일: 채용공고.pdf  [다운로드]                              │
│                                                                  │
│  위치 정보                                                       │
│  ───────────────────────────────────────────────────────────    │
│  주소:     서울특별시 강남구 역삼동 123-45                       │
│  좌표:     37.5012, 127.0396                                     │
│                                                                  │
│  상태 관리                                                       │
│  ───────────────────────────────────────────────────────────    │
│  현재 상태: 활성                                                 │
│             ( ) 활성    ( ) 비활성                               │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│              [닫기]         [수정하기]         [삭제]            │
└─────────────────────────────────────────────────────────────────┘
```

### 5.6 상세 보기 모달 (구직자)

```
┌─────────────────────────────────────────────────────────────────┐
│                        구직자 상세 정보                     [X] │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│         ┌─────────┐                                              │
│         │         │  열정교사01                                  │
│         │ 프로필  │  te***@gmail.com                             │
│         │         │  등록일: 2026-01-28                          │
│         └─────────┘                                              │
│                                                                  │
│  분류 정보                                                       │
│  ───────────────────────────────────────────────────────────    │
│  1차 분류:   교과과목                                            │
│  2차 분류:   수학, 과학                                          │
│  희망 학교급: 중학교, 고등학교                                   │
│                                                                  │
│  활동 정보                                                       │
│  ───────────────────────────────────────────────────────────    │
│  경력:         3~5년                                             │
│  활동가능 지역: 서울 전체, 경기 남부                             │
│                                                                  │
│  자기소개                                                        │
│  ───────────────────────────────────────────────────────────    │
│  수학과 과학을 재미있게 가르치는 교사입니다.                     │
│  학생 개개인의 눈높이에 맞춘 수업을 지향합니다.                  │
│                                                                  │
│  위치 정보                                                       │
│  ───────────────────────────────────────────────────────────    │
│  좌표:     37.5012, 127.0396                                     │
│                                                                  │
│  상태 관리                                                       │
│  ───────────────────────────────────────────────────────────    │
│  현재 상태: 활성                                                 │
│             ( ) 활성    ( ) 비활성                               │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│              [닫기]         [수정하기]         [삭제]            │
└─────────────────────────────────────────────────────────────────┘
```

### 5.7 상세 보기 모달 (강사)

```
┌─────────────────────────────────────────────────────────────────┐
│                        강사 상세 정보                       [X] │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│         ┌─────────┐                                              │
│         │         │  AI강사김                                    │
│         │ 프로필  │  ai***@gmail.com                             │
│         │         │  등록일: 2026-01-25                          │
│         └─────────┘                                              │
│                                                                  │
│  전문분야                                                        │
│  ───────────────────────────────────────────────────────────    │
│  전문분야:     에듀테크/AI, 융합/STEAM                           │
│  기타 전문분야: 챗GPT 활용 교육                                  │
│                                                                  │
│  연수 대상                                                       │
│  ───────────────────────────────────────────────────────────    │
│  대상:     교원, 교직원                                          │
│                                                                  │
│  활동 정보                                                       │
│  ───────────────────────────────────────────────────────────    │
│  경력:         5~10년                                            │
│  활동가능 지역: 서울 전체, 경기 전체, 인천                       │
│                                                                  │
│  활동내용                                                        │
│  ───────────────────────────────────────────────────────────    │
│  - 2024 OO교육청 AI활용 교원연수 강사                            │
│  - 2023 XX학교 에듀테크 직무연수                                 │
│  - 저서: 『교실에서 만나는 AI』                                  │
│                                                                  │
│  상태 관리                                                       │
│  ───────────────────────────────────────────────────────────    │
│  현재 상태: 활성                                                 │
│             ( ) 활성    ( ) 비활성                               │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│              [닫기]         [수정하기]         [삭제]            │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. 구현 상세 명세

### 6.1 필터 옵션

#### 공통 필터
| 필터 | 타입 | 옵션 |
|------|------|------|
| 검색어 | text | 제목/닉네임/조직명/이메일 |
| 등록일 | date range | 시작일 ~ 종료일 |
| 상태 | select | 전체, 활성, 비활성 |

#### 공고 전용 필터
| 필터 | 타입 | 옵션 |
|------|------|------|
| 1차 분류 | select | 8개 카테고리 |
| 긴급여부 | checkbox | 긴급공고만 |
| 마감여부 | select | 전체, 마감전, 마감됨 |

#### 구직/강사 전용 필터
| 필터 | 타입 | 옵션 |
|------|------|------|
| 1차 분류 / 전문분야 | multi-select | 해당 카테고리 |
| 활동가능 지역 | multi-select | 지역 목록 |
| 경력 | select | 신입, 1~3년, ... |

### 6.2 관리 액션

| 액션 | 대상 | 동작 | RLS 요구사항 |
|------|------|------|--------------|
| 상세보기 | 단일 | 모달 열기, 읽기 전용 | SELECT (기존 정책 충분) |
| 수정 | 단일 | 모달에서 필드 수정 → UPDATE | **is_admin() 통과 필요** |
| 비활성화 | 단일 | is_active = false | **is_admin() 통과 필요** |
| 활성화 | 단일 | is_active = true | **is_admin() 통과 필요** |
| 삭제 | 단일 | DELETE (확인 모달 필수) | **is_admin() 통과 필요** |

### 6.3 권한 체계

| 역할 | 조회 | 수정 | 삭제 | RLS 조건 |
|------|------|------|------|----------|
| admin | 전체 | 전체 | 전체 | `roles @> ARRAY['admin']` |
| 일반 사용자 | 활성만 | 본인만 | 본인만 | `auth.uid() = user_id` |

---

## 7. 구현 우선순위

### Phase 0: RLS 정책 마이그레이션 (필수 선행)
- [ ] `is_admin()` 함수 생성
- [ ] `job_postings` UPDATE/DELETE 정책 추가
- [ ] `teacher_markers`, `instructor_markers` 정책 통일
- [ ] 마이그레이션 테스트

### Phase 1: 기본 조회 (MVP)
- [ ] ContentManagement 컴포넌트 생성
- [ ] 3개 탭 (공고/구직/강사) 전환
- [ ] 테이블 목록 표시 (페이지네이션)
- [ ] 기본 검색 (텍스트)

### Phase 2: 상세 기능
- [ ] 상세보기 모달
- [ ] 필터 확장 (날짜, 상태, 분류)
- [ ] 개별 수정/삭제 기능

### Phase 3: 고급 기능
- [ ] 일괄 선택/작업
- [ ] 엑셀 내보내기
- [ ] 이력 로깅 (audit_logs)

---

## 8. 기술 고려사항

### 8.1 성능
- 페이지네이션: 서버사이드 (limit/offset)
- 정렬: created_at DESC 기본
- 인덱스: 검색 컬럼에 GIN 인덱스 활용

### 8.2 보안
- RLS: `is_admin()` 함수 기반 통합 관리
- 삭제 확인: 2단계 확인 (모달 + 텍스트 입력)
- 감사 로그: 변경 이력 기록

### 8.3 UX
- 로딩 스켈레톤
- 토스트 알림 (성공/실패)
- 반응형 테이블 (모바일 대응)

---

## 9. 참고 파일

### 등록 관련
- `src/components/map/LayerToggleBar.tsx` - 등록 버튼
- `src/components/job/JobPostingModal.tsx` - 공고등록 모달
- `src/components/map/TeacherMarkerModal.tsx` - 구직등록 모달
- `src/components/map/InstructorMarkerModal.tsx` - 강사등록 모달

### 데이터 레이어
- `src/lib/supabase/jobPostings.ts`
- `src/lib/supabase/markers.ts`
- `src/lib/supabase/instructorMarkers.ts`

### 타입 정의
- `src/types/index.ts` - JobPosting
- `src/types/markers.ts` - TeacherMarker
- `src/types/instructorMarkers.ts` - InstructorMarker

### 관리자 페이지
- `src/pages/AdminPage.tsx` - 관리자 메인
- `src/components/admin/` - 기존 관리자 컴포넌트

### RLS 정책 마이그레이션
- `supabase/migrations/20260130_add_super_admin_rls.sql` - 현재 Super Admin 정책
- `supabase/migrations/20260131_admin_user_management.sql` - user_profiles 정책

### 디자인 시스템
- `.claude/skills/anti-vibe-design/SKILL.md` - Anti-Vibe 디자인 지침
